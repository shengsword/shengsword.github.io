!function e(t,r,n){function i(a,o){if(!r[a]){if(!t[a]){var _="function"==typeof require&&require;if(!o&&_)return _(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[a]={exports:{}};t[a][0].call(l.exports,(function(e){return i(t[a][1][e]||e)}),l,l.exports,e,t,r,n)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){const n={Position:"vPosition",Normal:"vNormal",UV1:"vUV1",UV2:"vUV2",Tangent:"vTangent",Binormal:"vBinormal",JointIndex:"vJointIndex",JointWeight:"vJointWeight",VertexColor:"vColor",MorphPosition:"vMorphPosition",MorphPosition1:"vMorphPosition1",MorphPosition2:"vMorphPosition2",MorphPosition3:"vMorphPosition3",MorphPosition4:"vMorphPosition4"};t.exports=n},{}],2:[function(e,t,r){const n=e("./VertexAttribute"),i=e("./VertexBuffer"),s=e("./Model"),a=new n(new i(new Float32Array([-1,-1,4,-1,-1,4]),2));t.exports=({vs:e="\nprecision highp float;\nattribute vec2 position;\nvoid main() {\n    gl_Position = vec4(position.xy, 0.0, 1.0);\n}",fs:t,uniforms:r={}})=>new s({vs:e,fs:t,attributes:{position:a},vertexCount:3,uniforms:r})},{"./Model":8,"./VertexAttribute":16,"./VertexBuffer":17}],3:[function(e,t,r){const n=e("./Texture"),i=e("./WebGLConstants");t.exports=class extends n{constructor(e){(e=e||{}).wrapT=e.wrapT||i.CLAMP_TO_EDGE,e.wrapS=e.wrapS||i.CLAMP_TO_EDGE,e.mipMaping=void 0===e.mipMaping||e.mipMaping,super(e),this.name=e.name||"untitled",this._flipY=!1}get isCubeMap(){return!0}}},{"./Texture":15,"./WebGLConstants":20}],4:[function(e,t,r){const n=e("./Texture"),i=e("./WebGLConstants");class s extends n{constructor(e,t,r){(r=r||{}).magFilter=r.magFilter||i.NEAREST,r.minFilter=r.minFilter||i.NEAREST,r.mipMaping=!1,super(r),this.width=e,this.height=t,this._flipY=!1}}s.createFloat4=(e,t,r,n=!1)=>{const a=new Float32Array(e*t*4);return r&&r(a),new s(e,t,{format:i.RGBA,dataType:i.FLOAT,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,magFilter:n?i.LINEAR:i.NEAREST,minFilter:n?i.LINEAR:i.NEAREST,anistropy:1,width:e,height:t,source:a})},t.exports=s},{"./Texture":15,"./WebGLConstants":20}],5:[function(e,t,r){let n=0;t.exports=()=>n++},{}],6:[function(e,t,r){arguments[4][5][0].apply(r,arguments)},{dup:5}],7:[function(e,t,r){t.exports={}},{}],8:[function(e,t,r){const n=e("./WebGLConstants"),i=e("./HashShaderSet");t.exports=class{constructor({uniforms:e={},attributes:t,indices:r,vs:i,fs:s,drawMode:a=n.TRIANGLES,vertexCount:o,mesh:_,instanceCount:h}){this._vs=i,this._fs=s,this._uniforms=Object.assign({},e),this._attributes=t,this._indices=r,this._drawMode=a,this._vertexCount=o,this._instanceCount=h,this._shader={vs:i,fs:s},this._shaderHash=null}get vs(){return this._vs}get fs(){return this._fs}get instanceCount(){return this._instanceCount}get uniforms(){return this._uniforms}get attributes(){return this._attributes}get indices(){return this._indices}get vertexCount(){return this._vertexCount}get drawMode(){return this._drawMode}setUniforms(e){this._uniforms=Object.assign(this._uniforms,e)}setMesh(e){}get shaderHash(){return null===this._shaderHash&&this._computeShaderHash(),this._shaderHash}_computeShaderHash(){this._shaderHash=[this._hashShader(this._vs),this._hashShader(this._fs)].join("|")}_hashShader(e){const t=i[e];return t||(i[e]=Object.keys(i).length,i[e])}}},{"./HashShaderSet":7,"./WebGLConstants":20}],9:[function(e,t,r){var n=function(e,t){void 0===t&&(t=!1),this.initialize(e,t)};n.prototype.constructor=n,n.prototype.initialize=function(e,t){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this};var i=function(e,t){this.callback=e,this.mask=t};i.prototype.constructor=i;var s=function(){this._observers=[],this._eventState=new n(0)};s.prototype.constructor=s,s.prototype.add=function(e,t,r){if(void 0===t&&(t=-1),void 0===r&&(r=!1),!e)return null;var n=new i(e,t);return r?this._observers.unshift(n):this._observers.push(n),n},s.prototype.addUnique=function(e,t,r){for(var n=0;n<this._observers.length;n++)if(this._observers[n].callback===e)return!1;return this.add(e,t,r)},s.prototype.remove=function(e){var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},s.prototype.removeCallback=function(e){for(var t=0;t<this._observers.length;t++)if(this._observers[t].callback===e)return this._observers.splice(t,1),!0;return!1},s.prototype.notifyObservers=function(e,t){void 0===t&&(t=-1);var r=this._eventState;r.mask=t,r.skipNextObservers=!1;for(var n=0,i=this._observers;n<i.length;n++){var s=i[n];if(s.mask&t&&s.callback(e,r),r.skipNextObservers)return!1}return!0},s.prototype.hasObservers=function(){return this._observers.length>0},s.prototype.clear=function(){this._observers=[]},s.prototype.clone=function(){var e=new s;return e._observers=this._observers.slice(0),e},t.exports={EventState:n,Observable:s,Observer:i}},{}],10:[function(e,t,r){e("./AttributeNames"),e("./ProgramUniform"),e("./math/Mat4"),e("./WebGLConstants");const n=e("./GlobalID");t.exports=class{constructor({context:e,vs:t,fs:r}){this._id=n(),this._context=e,this._vs=t,this._fs=r,this._programUniforms=null,this._programAttributes=null,this._handler=null,this._samplersUnits={},this._initialize()}_initialize(){this._handler=this._context.createProgram(this._vs,this._fs),this._programUniforms=this._context.acquireProgramUniforms(this._handler),this._context.useProgram(this._handler);let e=0;for(const t in this._programUniforms){const r=this._programUniforms[t];if(!r.sampler)continue;let n=e;const i=r.size;r.array?(n=[...Array(i).keys()],r.setValue(n),e+=i):r.setValue(e++),this._samplersUnits[t]=n}this._programAttributes=this._context.acquireProgramAttributes(this._handler)}bindVertexAttributes(e={}){}_setUniform(e,t,r){}draw({uniforms:e,attributes:t,indices:r,drawMode:n,vertexCount:i,instanceCount:s}){this._context.useProgram(this._handler),this._context.setVertexArray(t,r,this);for(const t in e){const r=this._programUniforms[t];if(!r)continue;let n=e[t];r.size;if(r.sampler){const e=this._samplersUnits[t];let r=Array.isArray(e);if(r&&!Array.isArray(n)&&(n=[n]),r)for(let t=0;t<Math.min(e.length,n.length);t++)this._context.setTexture(n[t],e[t]);else this._context.setTexture(n,e)}else r.setValue(n)}const a=i,o=r;this._context._directDraw({instanceCount:s,drawMode:n,start:0,count:a,hasIndices:o})}}},{"./AttributeNames":1,"./GlobalID":5,"./ProgramUniform":11,"./WebGLConstants":20,"./math/Mat4":25}],11:[function(e,t,r){t.exports=class{constructor({location:e,cache:t,size:r,cacheSize:n,setter:i,type:s,sampler:a=!1,array:o=!1}){this._size=r,this._cacheSize=n,this._cacher=t?new Array(n):null,this._setter=i,this._location=e,this._type=s,this._sampler=a,this._array=o}get array(){return this._array}get size(){return this._size}get sampler(){return this._sampler}cache(e){if(!this._cacher)return!0;const t=this._cacher.length;var r=!1;if(1===t)this._cacher[0]!==e&&(this._cacher[0]=e,r=!0);else for(var n=0;n<t;n++)this._cacher[n]!==e[n]&&(this._cacher[n]=e[n],r=!0);return r}setValue(e){this.cache(e)&&this._setter(this._location,e)}}},{}],12:[function(e,t,r){const n=e("./WebGLConstants"),i=e("./GlobalId"),s=e("./Texture"),a=e("./CubeMap"),{Observable:o}=e("./Observable"),_=e("./DataTexture");class h{constructor(e){var t;if(this._id=i(),this._version=0,e=e||{},this.name=e.name||"untitled",e.texture?t=e.texture:(e.mipMaping=!!e.mipMaping,e.flipY=!1,(t=e.renderToCube?new a:new s(e)).width=e.width?e.width:512,t.height=e.height?e.height:512),this._renderToCube=t instanceof a,this._face=0,this._colorTexture=t,this.enableDepth=void 0!==e.enableDepth&&e.enableDepth,this.enableStencil=void 0!==e.enableStencil&&e.enableStencil,this.useDepthTexture=void 0!==e.useDepthTexture&&e.useDepthTexture,this._shareDepthFrom=e.shareDepthFrom,this.enableDepth&&this.useDepthTexture){if(!0===this._renderToCube)throw new Error("RenderTarget.renderToCube cant work with depthTexture");this.depthTexture=new s({dataType:this.enableStencil?n.UNSIGNED_INT_24_8:n.UNSIGNED_SHORT,mipMaping:!1}),this.depthTexture.width=t.width,this.depthTexture.height=t.height}this._viewport=e.viewport||[0,0,t.width,t.height],this.viewportChanged=!0,this.releaseObservable=new o}get colorTexture(){return this._colorTexture}get face(){return this._face}set face(e){this._face=e}get width(){return this._colorTexture.width}get height(){return this._colorTexture.height}resize(e,t){e===this.width&&t===this.height||(this.release(),this._colorTexture.width=e,this._colorTexture.height=t,this.setViewPort(0,0,e,t))}get renderToCube(){return this._renderToCube}release(){this.releaseObservable.notifyObservers(this)}setViewPort(e,t,r,n){var i=this._viewport;i[0]===e&&i[1]===t&&i[2]===r&&i[3]===n||(i[0]=e,i[1]=t,i[2]=r,i[3]=n,this.markDirty=!0)}copy(e){this._renderToCube=e._renderToCube,this._width=e._width,this._height=e._height,this._face=e._face,this._colorTexture=e._colorTexture.clone(),this.enableDepth=e.enableDepth,this.enableStencil=e.enableStencil,this._viewport=e._viewport.slice(0),this.viewportChanged=e.viewportChanged}get markDirty(){return!1}set markDirty(e){!0===e&&this._version++}}h.createFloat4=(e=512,t=512,r=null,n=!1)=>new h({width:e,height:t,texture:_.createFloat4(e,t,r,n)}),t.exports=h},{"./CubeMap":3,"./DataTexture":4,"./GlobalId":6,"./Observable":9,"./Texture":15,"./WebGLConstants":20}],13:[function(require,module,exports){const WebGLCompatibility=require("./WebGLCompatibility");var isStringInteger=function(e){return/^[\+|\-]?\d+$/.test(e)},getFinalDefinedValue=function(e,t){for(;e[t]&&t!==e[t];)t=e[t];return t},testIf=function(defines,line){if(line.startsWith("#ifdef"))return void 0!==defines[line.substr(7-line.length)];if(line.startsWith("#ifndef"))return void 0===defines[line.substr(8-line.length)];if(line.startsWith("#else"))return!0;for(var txt=line.match(/[#elif|#if]\s+(.*)/)[1],tokens=txt.split(/\b\d+\b|\W+|defined+/g),i=0;i<tokens.length;++i){var tok=tokens[i];if(tok){var value=getFinalDefinedValue(defines,defines[tok]);void 0===value||isStringInteger(value)||(value=!0),txt=txt.replace(tok,value)}}return eval("var defined = function(x) { return x !== undefined | 0; };\n"+txt)},processBranch=function(e,t,r,n){for(var i=[1],s=t;s<e.length;++s){var a=e[s].trim();if(a.startsWith("#endif"))i.length--;else if(a.startsWith("#el")){var o=i.length-1;0===i[o]?i[o]=testIf(r,a)?1:0:1===i[o]&&(i[o]=2)}else if(a.startsWith("#if"))i.push(testIf(r,a)?1:0);else{for(var _=!0,h=i.length;h--;)_=_&&1===i[h];if(_)if(a.startsWith("#"))if(a.startsWith("#extension"))n.push(a);else if(a.startsWith("#undef"))r[a.match(/#undef\s+(\w+)/)[1]]=void 0,n.push(a);else if(a.startsWith("#define")){var l=a.match(/#define\s+(\w+)\s*(.*)/);-1!==a.indexOf(l[1]+"(")?r[l[1]]={args:a.match(/\(.*?\)/)[0].match(/\w+/g),body:a.match(/\)(.*)/)[1]}:r[l[1]]=l[2]}else console.error("unknown preprocessor line: "+a);else n.push(a)}}},preprocessShaderSource=function(e){return e};module.exports={preprocessShaderSource:preprocessShaderSource}},{"./WebGLCompatibility":19}],14:[function(e,t,r){t.exports=class{constructor(e){this.performance=!0,this.startTime=0,this.stopTime=0,this.running=!1,this.performance=!1!==window.performance&&!!window.performance,this.preTime=0,e&&this.start()}currentTime(){return this.performance?window.performance.now():(new Date).getTime()}restart(){this.preTime=this.currentTime()}getIntervalMiniSeconds(){if(this.running){var e=this.currentTime(),t=e-this.preTime;return this.preTime=e,t}return window.window.console.warn("Stop-watch hasn't start yet, will return zero!"),0}getIntervalSeconds(){return this.getIntervalMiniSeconds()/1e3}start(){this.startTime=this.currentTime(),this.preTime=this.startTime,this.running=!0}stop(){this.stopTime=this.currentTime(),this.running=!1}getElapsedMilliseconds(){return this.running&&(this.stopTime=this.currentTime()),this.stopTime-this.startTime}getElapsedSeconds(){return this.getElapsedMilliseconds()/1e3}printElapsed(e){var t=e||"Elapsed:";window.window.console.log(t,"["+this.getElapsedMilliseconds()+"ms]","["+this.getElapsedSeconds()+"s]")}}},{}],15:[function(e,t,r){const{Observable:n}=e("./Observable"),i=e("./WebGLConstants"),s=e("./GlobalID"),a=e("./math/Vec2"),o=e("./math/Math");t.exports=class{constructor(e={}){this._id=s(),this._version=0,this._dataType=e.dataType||i.UNSIGNED_BYTE,this._internalFormat=e.internalFormat||i.RGBA,this._format=e.format||i.RGBA,this._source=e.source||null,this._mipMaping=e.mipMaping||!1,this._flipY=e.flipY||!1,this._wrapS=e.wrapS||i.CLAMP_TO_EDGE,this._wrapT=e.wrapT||i.CLAMP_TO_EDGE,this._magFilter=e.magFilter||i.LINEAR,this._minFilter=e.minFilter||i.LINEAR,this._anisotropy=e.anisotropy||16,this.releaseObservable=new n,this.rgbm=void 0!==e.rgbm&&e.rgbm,this._width=0,this._height=0,this._size=new a(this.width,this.height)}isPowerOfTwo(){return o.isPowerOfTwo(this.width)&&o.isPowerOfTwo(this.height)}get isTexture(){return!0}get width(){return this._width}set width(e){return this._size.x=e,this._width=e,this}get size(){return this._size}get height(){return this._height}set height(e){return this._size.y=e,this._height=e,this}get dataType(){return this._dataType}set dataType(e){if(this._dataType!==e)return this._dataType=e,this.markDirty=!0,this}get format(){return this._format}set format(e){if(this._format!==e)return this._format=e,this.markDirty=!0,this}get internalFormat(){return this._internalFormat}set internalFormat(e){if(this._internalFormat!==e)return this._internalFormat=e,this.markDirty=!0,this}get mipMaping(){return this._mipMaping}set mipMaping(e){if(this._mipMaping!==e)return this._mipMaping=e,this.markDirty=!0,this}get wrapS(){return this._wrapS}set wrapS(e){if(e!==this._wrapS)return this._wrapS=e,this.markDirty=!0,this}get wrapT(){return this._wrapT}set wrapT(e){if(e!==this._wrapT)return this._wrapT=e,this.markDirty=!0,this}get magFilter(){return this._magFilter}set magFilter(e){if(this._magFilter!==e)return this._magFilter=e,this.markDirty=!0,this}get minFilter(){return this._minFilter}set minFilter(e){if(this._minFilter!==e)return this._minFilter=e,this.markDirty=!0,this}get markDirty(){return!1}set markDirty(e){return!0===e&&(this._version=this._version+1),this}set source(e){if(this._source!==e)return this._source=e,this.markDirty=!0,this}get source(){return this._source}set flipY(e){this._flipY!==e&&(this._flipY=e,this.markDirty=!0)}get flipY(){return this._flipY}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy!==e&&(this._anisotropy=e,this.markDirty=!0)}release(){this.releaseObservable.notifyObservers(this)}copy(e){this._dataType=e._dataType,this._internalFormat=e._internalFormat,this._source=e._source,this._mipMaping=e._mipMaping,this.width=e.width,this.height=e.height,this.rgbm=e.rgbm,this._flipY=e._flipY,this._wrapS=e._wrapS,this._wrapT=e._wrapT,this._magFilter=e._magFilter,this._minFilter=e._minFilter,this.markDirty=!0}clone(){}}},{"./GlobalID":5,"./Observable":9,"./WebGLConstants":20,"./math/Math":26,"./math/Vec2":27}],16:[function(e,t,r){e("./AttributeNames");const n=e("./math/Vec4"),i=e("./math/Vec3"),s=e("./math/Vec2"),a=e("./GlobalID");class o{constructor(e,t,r,n=0){this._id=a(),this._buffer=e,this._array=e._array;var i=e.bytesPerElement;this._stride=e._stride,this._strideBytes=this._stride*i,this._offset=r||0,this._offsetBytes=this._offset*i,this._count=e._count,this._itemSize=t||this._stride,this._divisor=n,this.normalized=!1,this.get=o.getter(this._itemSize)}set(){for(var e=0,t=this._stride*arguments[e]+this._offset;e<this._itemSize;e++)this._array[t+e]=arguments[e+1]}setFromArray(e){for(var t,r=0,n=e.length/this._itemSize;r<n;r++){var i=r*this._stride+this._offset;for(t=0;t<this._itemSize;t++)this._array[i+t]=e[r*this._itemSize+t]}}get itemSize(){return this._itemSize}get stride(){return this._stride}get offset(){return this._offset}get count(){return this._count}set markDirty(e){!1!==e&&(this._buffer.markDirty=!0)}}var _;o.getter=((_=new Array(4))[0]=function(e){return this._array[this._stride*e+this._offset]},_[1]=function(e,t){var r=t||new s,n=e*this._stride+this._offset;return r.x=this._array[n],r.y=this._array[n+1],r},_[2]=function(e,t){var r=t||new i,n=e*this._stride+this._offset;return r.x=this._array[n],r.y=this._array[n+1],r.z=this._array[n+2],r},_[3]=function(e,t){var r=t||new n,i=e*this._stride+this._offset;return r.x=this._array[i],r.y=this._array[i+1],r.z=this._array[i+2],r.w=this._array[i+3],r},function(e){return _[e-1]}),t.exports=o},{"./AttributeNames":1,"./GlobalID":5,"./math/Vec2":27,"./math/Vec3":28,"./math/Vec4":29}],17:[function(e,t,r){e("./AttributeNames");const n=e("./WebGLConstants"),{Observable:i}=e("./Observable"),s=e("./GlobalID");t.exports=class{constructor(e,t,r=!0){this._id=s(),this._array=e,this._stride=t,this._storeType=function(e){return e instanceof Int8Array?n.BYTE:e instanceof Uint8Array?n.UNSIGNED_BYTE:e instanceof Int16Array?n.SHORT:e instanceof Uint16Array?n.UNSIGNED_SHORT:e instanceof Int32Array?n.INT:e instanceof Uint32Array?n.UNSIGNED_INT:e instanceof Float32Array?n.FLOAT:e instanceof Float64Array?n.DOUBLE:void 0}(e),this._count=e.length/t,this._version=0,this.releaseObservable=new i,this._staticUsage=r}set markDirty(e){!0===e&&this._version++}get bytesPerElement(){return this._array.BYTES_PER_ELEMENT}get length(){return this._array.length}release(){this.releaseObservable.notifyObservers(this,void 0)}}},{"./AttributeNames":1,"./GlobalID":5,"./Observable":9,"./WebGLConstants":20}],18:[function(e,t,r){const n=e("eventemitter3"),i=e("./WebGLContext"),s=e("./Program");t.exports=class extends n{constructor(e,t){super(),this._canvas=e,this._currentWidth=0,this._currentHeight=0,this.setupDevicePixelRatio(),this._context=new i(this._canvas,t),this._context.initializeStates(),this._programCache={}}get context(){return this._context}runTransform({}){}draw(e,t={}){let r=this._programCache[e.shaderHash];t.renderTarget;const n=this._context;if(void 0===r){const t=e.vs,i=e.fs;r=new s({vs:t,fs:i,context:n}),this._programCache[e.shaderHash]=r}const i=t.uniforms?Object.assign(e.uniforms,t.uniforms):e.uniforms,a=e.attributes,o=e.indices,_=e.vertexCount,h=e.drawMode,l=e.instanceCount;r.draw({uniforms:i,attributes:a,indices:o,vertexCount:_,drawMode:h,instanceCount:l})}get width(){return this._currentWidth}get height(){return this._currentHeight}get canvas(){return this._canvas}setupDevicePixelRatio(){const e=window.devicePixelRatio||1;this._devicePixelRatio=e}computeCanvasSize(){var e,t,r=this._canvas;(e=r.clientWidth)<1&&(e=1),(t=r.clientHeight)<1&&(t=1);var n=this._devicePixelRatio,i=Math.floor(e*n),s=Math.floor(t*n),a=!1;return this._currentWidth!==i&&(r.width=i,this._currentWidth=i,a=!0),this._currentHeight!==s&&(r.height=s,this._currentHeight=s,a=!0),a}}},{"./Program":10,"./WebGLContext":21,eventemitter3:32}],19:[function(e,t,r){const n=e("./WebGLUtils"),i=e("./Texture");var s=function(){this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0,this.hasFloatRTTSupport=!1,this.hasLinearHalfFloatRTTSupport=!1,this.hasHalfFloatRTTSupport=!1,this.hasLinearHalfFloatRTTSupport=!1};s.instance=function(e,t){if(!s._instance){var r,i=e;if(!i){"undefined"!=typeof window&&window.gli&&(r=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var a=document.createElement("canvas");a.width=32,a.height=32;var o={antialias:!1};o.extendWithOptionsURL(),i=n.setupWebGL(a,o,(function(){}))}s._instance=new s,i?s._instance.init(i):notify.warn("no support for webgl context detected."),r&&(window.gli.host.inspectContext=r)}return e&&(t||e!==s._instance.getContext())&&s._instance.initContextDependant(e),s._instance},s.prototype={getContext:function(){return this._gl},initContextDependant:function(e){this._gl=e,this._isGL2=void 0!==window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext,this.initWebGLExtensions(e),this.hasFloatRTTSupport=this.hasFloatRTT(e),this.hasLinearHalfFloatRTTSupport=this.hasLinearFloatRTT(e),this.hasHalfFloatRTTSupport=this.hasHalfFloatRTT(e),this.hasLinearHalfFloatRTTSupport=this.hasLinearHalfFloatRTT(e)},init:function(e){if(this.initWebGLParameters(e),this.initPlatformSupport(),this.initBugDB(),this.initContextDependant(e),this._isGL2)for(var t=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float_linear","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],r=s._instance.getWebGLExtensions(),n=function(){},i=0,a=t.length;i<a;i++)r[t[i]]=n},isWebGL2:function(){return this._isGL2},initBugDB:function(){var e=this._webGLPlatforms,t=this._webGLParameters;e.Apple&&(t.UNMASKED_VENDOR_WEBGL&&-1===t.UNMASKED_VENDOR_WEBGL.indexOf("Intel")||(this._bugsDB.OES_standard_derivatives=!0))},initPlatformSupport:function(){var e=this._webGLPlatforms;e.Apple=-1!==navigator.vendor.indexOf("Apple")||-1!==navigator.vendor.indexOf("OS X"),e.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(e){return this._webGLPlatforms[e]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(e){return this._webGLParameters[e]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(e,t,r){var n=t+","+r;if(this._isGL2)return!!this._webGLExtensions.EXT_color_buffer_float;if(void 0!==this._checkRTT[n])return this._checkRTT[n];if(!e)return!1;var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r);var s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0);var a=this._checkRTT[n]=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.deleteTexture(i),e.deleteFramebuffer(s),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),a},hasLinearHalfFloatRTT:function(e){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(e,e.HALF_FLOAT,e.LINEAR)},hasHalfFloatRTT:function(e){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(e,e.HALF_FLOAT,e.NEAREST)},hasLinearFloatRTT:function(e){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(e,e.FLOAT,e.LINEAR)},hasFloatRTT:function(e){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(e,e.FLOAT,e.NEAREST)},queryPrecision:function(e,t,r){var n=e.getShaderPrecisionFormat(t,r);return!!n&&0!==n.precision},hasVAO:function(){return!!this._webGLExtensions.OES_vertex_array_object},getDisjointTimerQuery:function(){return this._webGLExtensions.EXT_disjoint_timer_query_webgl2||this._webGLExtensions.EXT_disjoint_timer_query},initWebGLParameters:function(e){if(e){for(var t=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],r=this._webGLParameters,n=0,i=t.length;n<i;++n){var s=t[n];r[s]=e.getParameter(e[s])}this.queryPrecision(e,e.FRAGMENT_SHADER,e.HIGH_FLOAT)?r.MAX_SHADER_PRECISION_FLOAT="highp":this.queryPrecision(e,e.FRAGMENT_SHADER,e.MEDIUM_FLOAT)?r.MAX_SHADER_PRECISION_FLOAT="mediump":this.queryPrecision(e,e.FRAGMENT_SHADER,e.LOW_FLOAT)&&(r.MAX_SHADER_PRECISION_FLOAT="lowp"),this.queryPrecision(e,e.FRAGMENT_SHADER,e.HIGH_INT)?r.MAX_SHADER_PRECISION_INT="highp":this.queryPrecision(e,e.FRAGMENT_SHADER,e.MEDIUM_INT)?r.MAX_SHADER_PRECISION_INT="mediump":this.queryPrecision(e,e.FRAGMENT_SHADER,e.LOW_INT)&&(r.MAX_SHADER_PRECISION_INT="lowp");var a=e.getExtension("WEBGL_debug_renderer_info");a&&(r.UNMASKED_RENDERER_WEBGL=e.getParameter(a.UNMASKED_RENDERER_WEBGL),r.UNMASKED_VENDOR_WEBGL=e.getParameter(a.UNMASKED_VENDOR_WEBGL))}},applyExtension:function(e,t){var r=e.getExtension(t),n=t.split("_")[0],i="_"+n,s=new RegExp(n+"$"),a=new RegExp(i);for(var o in r){if("function"==typeof r[o]){var _=o.replace(s,"");void 0===e[_]&&(e[_]=r[o].bind(r))}else{var h=o.replace(a,"");void 0===e[h]&&(e[h]=r[o])}}},getWebGLExtension:function(e){return this._webGLExtensions[e]},getWebGLExtensions:function(){return this._webGLExtensions},_checkShader:function(e,t,r){var n=t;"string"==typeof n&&(n=e[t]);var i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),!(!e.getShaderParameter(i,e.COMPILE_STATUS)&&!e.isContextLost())},_doubleCheckExtension:function(e,t){var r=["#version 100","#extension GL_%ext% : enable","precision mediump float;","varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"].join("\n");return this._checkShader(e,"FRAGMENT_SHADER",r.replace(/\%ext\%/g,t))},initWebGLExtensions:function(e,t){if(e){var r=t;void 0===r&&(r=!0);var n=e.getSupportedExtensions();if(n){for(var s=this._webGLExtensions,a=0,o=n.length;a<o;++a){var _=n[a];r&&this._bugsDB[_]||(s[_]=e.getExtension(_),this._isGL2||this.applyExtension(e,_))}if(!this._isGL2){var h="EXT_shader_texture_lod";s[h]&&!this._doubleCheckExtension(e,h)&&delete s[h]}var l=this.getWebGLExtension("EXT_texture_filter_anisotropic");l?(i.ANISOTROPIC_SUPPORT_EXT=!0,i.ANISOTROPIC_SUPPORT_MAX=e.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):(i.ANISOTROPIC_SUPPORT_EXT=!1,i.ANISOTROPIC_SUPPORT_MAX=1)}}}},t.exports=s},{"./Texture":15,"./WebGLUtils":23}],20:[function(e,t,r){t.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},{}],21:[function(e,t,r){const n=e("./WebGLHandlerSet"),i=e("./AttributeNames"),s=e("./math/Vec4"),a=e("./math/Math"),o=e("./Program"),_=e("./DataTexture"),h=e("./WebGLUtils"),l=e("./WebGLCompatibility"),u=e("./Texture"),{preprocessShaderSource:c}=e("./ShaderProcess"),E=e("./ProgramUniform"),T=e("./WebGLConstants");t.exports=class{constructor(e,t={webgl2:!1}){this._gl=h.setupWebGL(e,{antialias:!0,webgl2:!!t.webgl2,reportWebGLError:!1}),l.instance(this._gl,!0),this.screenViewportDirty=!0,this._currentBlendState=!1,this._currentPixelFlipY=!1,this._currentActiveTextureUnit=null,this._currentClear=this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT,this._auxCanvas2D=document.createElement("canvas"),this._auxContext2D=this._auxCanvas2D.getContext("2d"),this._currentCullState=null,this._cullStateList=[0,this._gl.BACK,this._gl.FRONT,this._gl.FRONT_AND_BACK],this._currentDepthMask=null,this._curDepthTest=null,this._currentLineWidth=null,this._currentBoundTextures=new Array(l.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS")),this._currentBoundTextureTargets=new Array(l.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS")),this._currentBoundProgramHandler=null,this._enableAttributes=new Uint8Array(l.instance().getWebGLParameter("MAX_VERTEX_ATTRIBS")),this._newEnableAttributes=new Uint8Array(l.instance().getWebGLParameter("MAX_VERTEX_ATTRIBS")),this._webGLBufferSet=new n,this._webGLTextureSet=new n,this._webGLRenderTargetSet=new n,this._currentViewportState=[0,0,800,600],this._currentDefaultViewport=[0,0,800,600],this._currentFramebufferObject=null,this._currentRenderTarget=null,this._currentBlendMode=null,this._currentBoundIndexBuffer=null,this._currentClearColor=new s(0,0,0,0),this._effectCaches={},this.gl=this._gl,this.isWebGL2=!!t.webgl2,this.compatiblity=l;const r=this;var i;this._renderTargetFactory={checkFramebufferStatus:function(){switch(r._gl.checkFramebufferStatus(r._gl.FRAMEBUFFER)){case r._gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:window.console.error("ERROR: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case r._gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:window.console.error("ERROR: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case r._gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:window.console.error("ERROR: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case r._gl.FRAMEBUFFER_UNSUPPORTED:window.console.error("ERROR: FRAMEBUFFER_UNSUPPORTED");break;case r._gl.FRAMEBUFFER_COMPLETE:}},attachDepthRenderBuffer:function(e,t,n,i,s){r._gl.bindRenderbuffer(r._gl.RENDERBUFFER,t),s?(r._gl.renderbufferStorage(r._gl.RENDERBUFFER,r._gl.DEPTH_STENCIL,n,i),r._gl.framebufferRenderbuffer(r._gl.FRAMEBUFFER,r._gl.DEPTH_STENCIL_ATTACHMENT,r._gl.RENDERBUFFER,t)):(r._gl.renderbufferStorage(r._gl.RENDERBUFFER,r._gl.DEPTH_COMPONENT16,n,i),r._gl.framebufferRenderbuffer(r._gl.FRAMEBUFFER,r._gl.DEPTH_ATTACHMENT,r._gl.RENDERBUFFER,t)),r._gl.bindRenderbuffer(r._gl.RENDERBUFFER,null)},allocate:function(e){r._webGLRenderTargetSet.get(e)._fbo=r._gl.createFramebuffer()},releaseImp:function(e,t){var n=e._fbo,i=e._depthBuffer;if(t)for(var s=0;s<n.length;s++)r._gl.deleteFramebuffer(n[s]),i&&r._gl.deleteRenderbuffer(i[s]);else r._gl.deleteFramebuffer(n),i&&r._gl.deleteRenderbuffer(i)},release:function(e){var t=r._webGLRenderTargetSet.get(e);void 0!==t&&(e.colorTexture.release(),r._renderTargetFactory.releaseImp(t,e._renderToCube),r._webGLRenderTargetSet.remove(e),e.releaseObservable.removeCallback(r.release))},construct:function(e){var t=r._webGLRenderTargetSet.get(e);if(r._gl.bindFramebuffer(r._gl.FRAMEBUFFER,t._fbo),r.useTexture2D(e.colorTexture,0),r._gl.framebufferTexture2D(r._gl.FRAMEBUFFER,r._gl.COLOR_ATTACHMENT0,r._gl.TEXTURE_2D,r._webGLTextureSet.get(e.colorTexture)._texID,0),!0===e.enableDepth){if(e._shareDepthFrom)var n=e._shareDepthFrom;if(e.useDepthTexture){n&&console.error("RenderTarget could not shared depth-texture yet..."),_scope.useTexture2D(e.depthTexture,0);var i=r._webGLTextureSet.get(e.depthTexture),s=e.enableStencil?r._gl.DEPTH_STENCIL_ATTACHMENT:r._gl.DEPTH_ATTACHMENT;r._gl.framebufferTexture2D(r._gl.FRAMEBUFFER,s,r._gl.TEXTURE_2D,i._texID,0)}else{if(n){var a=r._webGLRenderTargetSet.get(n),o=a._depthBuffer;o||(a._depthBuffer=r._gl.createRenderbuffer()),t._depthBuffer=o}else t._depthBuffer||(t._depthBuffer=r._gl.createRenderbuffer());this.attachDepthRenderBuffer(t._fbo,t._depthBuffer,e.width,e.height,e.enableStencil)}this.checkFramebufferStatus()}r._gl.bindFramebuffer(r._gl.FRAMEBUFFER,null)},allocateCube:function(e){for(var t=new Array(6),n=0;n<t.length;n++)t[n]=r._gl.createFramebuffer();r._webGLRenderTargetSet.get(e)._fbo=t},constructCube:function(e){var t=r._webGLRenderTargetSet.get(e),n=t._fbo,i=e.colorTexture;r.useCubeMap(i,0);for(var s=0;s<n.length;s++)r._gl.bindFramebuffer(r._gl.FRAMEBUFFER,n[s]),r._gl.framebufferTexture2D(r._gl.FRAMEBUFFER,r._gl.COLOR_ATTACHMENT0,r._gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,r._webGLTextureSet.get(i)._texID,0),!0===e.enableDepth&&(t._depthBuffer||(t._depthBuffer=new Array(n.length)),t._depthBuffer[s]=r._gl.createRenderbuffer(),this.attachDepthRenderBuffer(t._fbo[s],t._depthBuffer[s],e.width,e.height,e.enableStencil)),r._gl.bindFramebuffer(r._gl.FRAMEBUFFER,null)},generateMipMap:function(e){var t=e.colorTexture;if(!0===t._mipMaping&&t.isPowerOfTwo()){var n=r._webGLTextureSet.get(t),i=!0===t.isCubeMap?r._gl.TEXTURE_CUBE_MAP:r._gl.TEXTURE_2D;_scope.bindTexture(i,n._texID),r._gl.generateMipmap(i),_scope.bindTexture(i,null)}},read:(i=null,function(e,t,n,s,a){null===i&&(i=function(e,t,n,i,s,a,o){var _,h=t,u=n,c=4*a*o;return n===T.UNSIGNED_BYTE?_=new Uint8Array(c):n===T.FLOAT&&(_=new Float32Array(c)),t!==T.RGBA&&h!==r._gl.getParameter(r._gl.IMPLEMENTATION_COLOR_READ_FORMAT)&&window.console.error("renderTarget is not in RGBA or implementation defined format."),n===T.UNSIGNED_BYTE||u===r._gl.getParameter(r._gl.IMPLEMENTATION_COLOR_READ_TYPE)||n===T.FLOAT&&l.instance().FloatColorBuffer||window.console.error("renderTarget is not in UnsignedByteType or implementation defined type."),r._gl.readPixels(i,s,a,o,h,u,_),_});var o=[],_=!1;if(e){t=void 0===t?0:t,n=void 0===n?0:n,s=void 0===s?e.width:s,a=void 0===a?e.height:a;var h=r._webGLRenderTargetSet.get(e);_=e.renderToCube;for(var u=e.colorTexture,c=_?h._fbo:[h._fbo],E=0;E<c.length;E++)o.push(i(c[E],u.format,u.dataType,t,n,s,a))}else t=void 0===t?r._viewport[0]:t,n=void 0===n?r._viewport[1]:n,s=void 0===s?r._viewport[2]:s,a=void 0===a?r._viewport[3]:a,o.push(i(null,T.RGBA,T.UNSIGNED_BYTE,t,n,s,a));return 1===o.length?o[0]:o})},this.blendFuncSeparate({srcRGB:T.SRC_ALPHA,dstRGB:T.ONE_MINUS_SRC_ALPHA,srcAlpha:T.ONE,dstAlpha:T.ONE_MINUS_SRC_ALPHA})}initializeStates(){this.clearMode(!0,!0,!1),this.clearColor(0,0,0,1),this._gl.depthFunc(this._gl.LEQUAL),this.depthMask(!0),this.depthTest(!0),this._gl.depthRange(0,1),this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this._gl.BACK),this._currentCull=i.CullBack,this._gl.hint(this._gl.GENERATE_MIPMAP_HINT,this._gl.NICEST),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE)}cullstate(e){this._currentCullState!==e&&(e===T.FRONT_AND_BACK?this._gl.disable(this._gl.CULL_FACE):(null===this._currentCullState&&this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(e)),this._currentCullState=null)}clear(){(this._currentClearBitMask&this._gl.DEPTH_BUFFER_BIT)===this._gl.DEPTH_BUFFER_BIT&&this.depthMask(!0),this._gl.clear(this._currentClearBitMask)}clearColor(e,t,r,n){this._currentClearColor.x===e&&this._currentClearColor.y===t&&this._currentClearColor.z===r&&this._currentClearColor.w===n||(this._gl.clearColor(e,t,r,n),this._currentClearColor.set(e,t,r,n))}getClearColor(e){return e?e.copy(this._currentClearColor):e=this._currentClearColor.clone(),e}clearMode(e,t,r){if(1===arguments.length)this._currentClearBitMask=arguments[0];else{var n=0;e&&(n=this._gl.COLOR_BUFFER_BIT),t&&(n|=this._gl.DEPTH_BUFFER_BIT),r&&(n|=this._gl.STENCIL_BUFFER_BIT),this._currentClearBitMask=n}}getClearMode(){return this._currentClearBitMask}setScreenViewport(e){this._currentDefaultViewport[0]=e[0],this._currentDefaultViewport[1]=e[1],this._currentDefaultViewport[2]=e[2],this._currentDefaultViewport[3]=e[3],this.screenViewportDirty=!0}viewport(e){this._currentViewportState[2]===e[2]&&this._currentViewportState[3]===e[3]&&this._currentViewportState[0]===e[0]&&this._currentViewportState[1]===e[1]||(this._gl.viewport(e[0],e[1],e[2],e[3]),this._currentViewportState[0]=e[0],this._currentViewportState[1]=e[1],this._currentViewportState[2]=e[2],this._currentViewportState[3]=e[3])}pixelFlipY(e){this._currentPixelFlipY!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e),this._currentPixelFlipY=e)}depthMask(e){this._currentDepthMask!==e&&(this._gl.depthMask(e),this._currentDepthMask=e)}blend(e){this._currentBlendState!==e&&(!0===e?this._gl.enable(this._gl.BLEND):this._gl.disable(this._gl.BLEND),this._currentBlendState=e)}depthTest(e){this._curDepthTest!==e&&(!0===e?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._curDepthTest=e)}lineWidth(e){e!==this._currentLineWidth&&(this._gl.lineWidth(e),this._currentLineWidth=e)}activateTextureUnit(e){e!==this._currentActiveTextureUnit&&(this._gl.activeTexture(this._gl.TEXTURE0+e),this._currentActiveTextureUnit=e)}bindTex2Unit(e,t,r){e===this._currentBoundTextureTargets[r]&&t===this._currentBoundTextures[r]||(r!==this._currentActiveTextureUnit&&(this._gl.activeTexture(this._gl.TEXTURE0+r),this._currentActiveTextureUnit=r),this._currentBoundTextures[r]=t,this._currentBoundTextureTargets[r]=e,this._gl.bindTexture(e,t))}bindTexture(e,t){e===this._currentBoundTextureTargets[this._currentActiveTextureUnit]&&t===this._currentBoundTextures[this._currentActiveTextureUnit]||(this._currentBoundTextures[this._currentActiveTextureUnit]=t,this._currentBoundTextureTargets[this._currentActiveTextureUnit]=e,this._gl.bindTexture(e,t))}makeImagePowerOfTwo(e){return a.isPowerOfTwo(e.width)&&a.isPowerOfTwo(e.height)?e:(this._auxCanvas2D.width=a.nextPowerOfTwo(e.width),this._auxCanvas2D.height=a.nextPowerOfTwo(e.height),this._auxContext2D.drawImage(e,0,0,e.width,e.height,0,0,this._auxCanvas2D.width,this._auxCanvas2D.height),window.console.warn("WebGLEngine.makeImagePowerOfTwo: convert ("+e.width+" "+e.height,") to ("+this._auxCanvas2D.width+" "+this._auxCanvas2D.height+")"),this._auxCanvas2D)}textureImage2D(e,t){var r=e.dataType,n=e.format,i=e.internalFormat;t=t||e.source,e instanceof _||null===t?this._gl.texImage2D(this._gl.TEXTURE_2D,0,i,e.width,e.height,0,n,r,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,i,n,r,t)}finish(){this._gl.finish()}_releaseBuffer(e){var t=this._webGLBufferSet.find(e);void 0!==t&&(this._gl.deleteBuffer(t._vbo),this._webGLBufferSet.remove(e),e.releaseObservable.removeCallback(this._releaseBuffer))}_releaseTexture(e){var t=this._webGLTextureSet.find(e);void 0!==t&&(this._gl.deleteTexture(t._texID),this._webGLTextureSet.remove(e),e.releaseObservable.removeCallback(this._releaseTexture.bind(this)))}texImageCubeMap(e){var t,r,n,i=e.dataType,s=e.internalFormat,a=e.internalFormat,o=0;for(e.source instanceof Array&&0!==e.source.length&&e.source[0]instanceof Array||window.console.error("cubemap source invalid");e._source[o]||0===o;){if(t=e._source[o],1===o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),t[0]instanceof HTMLCanvasElement||t[0]instanceof HTMLImageElement)for(n=0;n<6;n++){var _=t[n];this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,o,s,a,i,this.makeImagePowerOfTwo(_))}else{var h=e.width,l=e.height;for(r=1/Math.pow(2,o),n=0;n<6;n++){var u=t[n];this._gl.texImage2D(this._gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,o,s,Math.max(h*r,1),Math.max(l*r,1),0,a,i,u)}}o++}1===o&&e.mipMaping&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP)}textureParameter(e,t,r){var n=void 0===r?t.isPowerOfTwo():r,i=l.instance();if(t._anisotropy>1&&t._anisotropy<=u.ANISOTROPIC_SUPPORT_MAX&&i.getWebGLExtension("EXT_texture_filter_anisotropic")&&this._gl.texParameterf(e,i.getWebGLExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,t._anisotropy),t.wrapS){var s=n?t.wrapS:T.CLAMP_TO_EDGE;this._gl.texParameterf(e,this._gl.TEXTURE_WRAP_S,s)}if(t.wrapT){var a=n?t.wrapT:T.CLAMP_TO_EDGE;this._gl.texParameterf(e,this._gl.TEXTURE_WRAP_T,a)}t.magFilter&&this._gl.texParameterf(e,this._gl.TEXTURE_MAG_FILTER,t.magFilter),t.minFilter&&(t.mipMaping&&n?this._gl.texParameterf(e,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR_MIPMAP_LINEAR):this._gl.texParameterf(e,this._gl.TEXTURE_MIN_FILTER,t.minFilter))}setTexture(e,t){e.isCubeMap?this.useCubeMap(e,t):e.isTexture&&this.useTexture2D(e,t)}useCubeMap(e,t){var r=this._webGLTextureSet.get(e);r._version!==e._version?(void 0===r._texID&&(r._texID=this.createTexture(),e.releaseObservable.addUnique(this._releaseTexture.bind(this))),this.activateTextureUnit(t),this.bindTexture(this._gl.TEXTURE_CUBE_MAP,r._texID),this.pixelFlipY(e.flipY),this.texImageCubeMap(e),this.textureParameter(this._gl.TEXTURE_CUBE_MAP,e),r._version=e._version):this.bindTex2Unit(this._gl.TEXTURE_CUBE_MAP,r._texID,t)}createTexture(){return this._gl.createTexture()}useTexture2D(e,t){if(e){var r=this._webGLTextureSet.get(e);if(r._version!==e._version){void 0===r._texID&&(r._texID=this.createTexture(),e.releaseObservable.addUnique(this._releaseTexture.bind(this))),this.activateTextureUnit(t),this.bindTexture(this._gl.TEXTURE_2D,r._texID),this.pixelFlipY(e.flipY);var n=e.isPowerOfTwo(),i=e.source;if(!this.isWebGL2&&i&&!1===n)!0===(e._minFilter!==T.NEAREST&&e._minFilter!==T.LINEAR||!(e._wrapS===T.CLAMP_TO_EDGE&&e._wrapT===T.CLAMP_TO_EDGE))&&(i=this.makeImagePowerOfTwo(i),n=!0);this.textureImage2D(e,i),this.textureParameter(this._gl.TEXTURE_2D,e,this.isWebGL2||n),e.mipMaping&&(this.isWebGL2||n)&&this._gl.generateMipmap(this._gl.TEXTURE_2D),r._version=e._version}else this.bindTex2Unit(this._gl.TEXTURE_2D,r._texID,t)}}generateMipMap(e){var t=this._webGLTextureSet.get(e);this.activateTextureUnit(0),this.bindTexture(this._gl.TEXTURE_2D,t._texID),this._gl.generateMipmap(this._gl.TEXTURE_2D)}createBuffer(e){var t=this._gl.createBuffer();return t._typeSize=e.bytesPerElement,t._glType=e._storeType,t}bindIndexBuffer(e){e&&e!==this._currentBoundIndexBuffer&&(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e),this._currentBoundIndexBuffer=e)}bindVertexBuffer(e){e!==this._currentBoundVertexBuffer&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._currentBoundVertexBuffer=e)}dynamicVertexBufferData(e){this._gl.bufferData(this._gl.ARRAY_BUFFER,e._array,this._gl.DYNAMIC_DRAW)}staticVertexBufferData(e){this._gl.bufferData(this._gl.ARRAY_BUFFER,e._array,this._gl.STATIC_DRAW)}staticIndexBufferData(e){this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e._array,this._gl.STATIC_DRAW)}dynamicIndexBufferData(e){this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e._array,this._gl.DYNAMIC_DRAW)}updateVertexBuffer(e,t){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,e._array)}updateIndexBuffer(e,t){this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,t,e._array)}loadShaderByType(e,t){var r=this._gl.createShader(e);if(null===r)return window.console.error("unable to create"+e+"shader"),null;if(this._gl.shaderSource(r,t),this._gl.compileShader(r),!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)){var n=this._gl.getShaderInfoLog(r);this._gl.deleteShader(r);const e=Number(n.match(/:[0-9]*:/g)[0].split(":")[1]);var i=t.split("\n");let s="Failed to compile "+n+"\n";for(let t=Math.max(0,e-3);t<=e;t++)s+=t+": "+i[t]+"\n";throw s}return r}createProgram(e,t){e=c(e),t=c(t);var r=this.loadShaderByType(this._gl.VERTEX_SHADER,e),n=this.loadShaderByType(this._gl.FRAGMENT_SHADER,t);if(!r||!n)return null;var i=this._gl.createProgram();if(this._gl.attachShader(i,r),this._gl.attachShader(i,n),this._gl.linkProgram(i),!this._gl.getProgramParameter(i,this._gl.LINK_STATUS)){var s=this._gl.getProgramInfoLog(i);return console.error("Failed to link program: "+s),this._gl.deleteProgram(i),null}return this._gl.deleteShader(n),this._gl.deleteShader(r),i}acquireProgramUniforms(e){for(var t=/^([\w\d_]+)\[0]$/,r={},n=this._gl.getProgramParameter(e,this._gl.ACTIVE_UNIFORMS),i=0;i<n;i++){const n=this._gl.getActiveUniform(e,i),s=n.type,a=n.size;let o=!0,_=!1,h=null;const l=t.exec(n.name),u=!!l,c=l?l[1]:n.name,T=this._gl.getUniformLocation(e,c);let d=a;switch(s){case this._gl.SAMPLER_2D:case this._gl.SAMPLER_CUBE:h=u?this._gl.uniform1iv.bind(this._gl):this._gl.uniform1i.bind(this._gl),_=!0;break;case this._gl.FLOAT:h=u?this._gl.uniform1fv.bind(this._gl):this._gl.uniform1f.bind(this._gl);break;case this._gl.INT:h=u?this._gl.uniform1iv.bind(this._gl):this._gl.uniform1i.bind(this._gl);break;case this._gl.FLOAT_VEC2:h=u?this._gl.uniform2fv.bind(this._gl):(e,t)=>{this._gl.uniform2f(e,t[0],t[1])},d=2*a;break;case this._gl.FLOAT_VEC3:h=u?this._gl.uniform3fv.bind(this._gl):(e,t)=>{this._gl.uniform3f(e,t[0],t[1],t[2])},d=3*a;break;case this._gl.FLOAT_VEC4:h=u?this._gl.uniform4fv.bind(this._gl):(e,t)=>{this._gl.uniform4f(e,t[0],t[1],t[2],t[3])},d=4*a;break;case this._gl.FLOAT_MAT2:h=(e,t)=>{this._gl.uniformMatrix2fv(e,!1,t)},d=4*a;break;case this._gl.FLOAT_MAT3:h=(e,t)=>{this._gl.uniformMatrix3fv(e,!1,t)},d=9*a,o=!1;break;case this._gl.FLOAT_MAT4:h=(e,t)=>{this._gl.uniformMatrix4fv(e,!1,t)},d=16*a,o=!1}r[c]=new E({location:T,cache:o,array:u,size:a,cacheSize:d,sampler:_,setter:h,type:s})}return r}acquireProgramAttributes(e){for(var t={},r=this._gl.getProgramParameter(e,this._gl.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var i=this._gl.getActiveAttrib(e,n).name;t[i]=this._gl.getAttribLocation(e,i)}return t}useProgram(e){this._currentBoundProgramHandler!==e&&(this._gl.useProgram(e),this._currentBoundProgramHandler=e)}enableAttribute(e){0===this._enableAttributes[e]&&(this._enableAttributes[e]=1,this._gl.enableVertexAttribArray(e))}disableAttribute(e){1===this._enableAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enableAttributes[e]=0)}getCurrentRenderTarget(){return this._currentRenderTarget}bindRenderTarget(e){var t=null;this._currentRenderTarget=e;let r=!1;if(e){var n=this._webGLRenderTargetSet.get(e),i=e.renderToCube;n._version!==e._version&&(void 0===n._fbo&&(i?(this._renderTargetFactory.allocateCube(e),e.releaseObservable.addUnique(this._renderTargetFactory.release),this._renderTargetFactory.constructCube(e)):(this._renderTargetFactory.allocate(e),e.releaseObservable.addUnique(this._renderTargetFactory.release),this._renderTargetFactory.construct(e))),r=!0,n._version=e._version),t=!0===i?n._fbo[e._face]:n._fbo}else t=null;this._currentFramebufferObject!==t&&(this._currentFramebufferObject=t,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._currentFramebufferObject),r=!0),(!0===this.screenViewportDirty||r)&&(this.viewport(e?e._viewport:this._currentDefaultViewport),this.screenViewportDirty=!1)}renderTargetMipmap(e){e&&this._renderTargetFactory.generateMipMap(e)}readRenderTarget(e,t,r,n,i){return this.bindRenderTarget(e),this._renderTargetFactory.read(e,t,r,n,i)}getViewPort(e){return e||(e=new Array(4)),e[0]=this._viewport[0],e[1]=this._viewport[1],e[2]=this._viewport[2],e[3]=this._viewport[3],e}setVertexArray(e,t,r){var n,i,s=r._programAttributes,a=null;for(var o in s)n=s[o],(i=e[o])&&(a!==i._buffer&&(a=i._buffer,this.setupVertexBuffer(a)),this.enableAttribute(n),this._newEnableAttributes[n]=1,this._gl.vertexAttribPointer(n,i._itemSize,a._storeType,i.normalized,i._strideBytes,i._offsetBytes),i._divisor>0&&this._gl.vertexAttribDivisor(n,i._divisor));t&&this.setupIndexBuffer(t._buffer);for(var _=0;_<this._enableAttributes.length;_++)this._newEnableAttributes[_]!==this._enableAttributes[_]?(this._gl.disableVertexAttribArray(_),this._enableAttributes[_]=0):this._newEnableAttributes[_]=0}setupIndexBuffer(e){var t=this._webGLBufferSet.get(e);if(void 0===t._vbo){var r=this.createBuffer(e);e.releaseObservable.addUnique(this._releaseBuffer),t._vbo=r,this.bindIndexBuffer(r),e._staticUsage?this.staticIndexBufferData(e):this.dynamicIndexBufferData(e)}else t._version<e._version?(this.bindIndexBuffer(t._vbo),this.updateIndexBuffer(e)):this.bindIndexBuffer(t._vbo);t._version=e._version}setupVertexBuffer(e){const t=this._webGLBufferSet.get(e);if(void 0===t._vbo){var r=this.createBuffer(e);e.releaseObservable.addUnique(this._releaseBuffer),t._vbo=r,t._glType=r._glType,this.bindVertexBuffer(r),e._staticUsage?this.staticVertexBufferData(e):this.dynamicVertexBufferData(e)}else e._version>t._version?(this.bindVertexBuffer(t._vbo),this.updateVertexBuffer(e,0)):this.bindVertexBuffer(t._vbo);t._version=e._version}getEffectById(e){return this._effectCaches[e]}createEffect(e,t,r){return this._effectCaches[e]=new o(this,t,r,""),this._effectCaches[e]}releaseAllBuffers(){this._webGLBufferSet.iterate((function(e){e._vbo&&this._gl.deleteBuffer(e._vbo)})),this._webGLBufferSet.clear()}releaseAllTextures(){this._webGLTextureSet.iterate((function(e){e._texID&&this._gl.deleteTexture(e._texID)})),this._webGLTextureSet.clear()}releaseAllRenderTargets(){var e=this._renderTargetFactory;this._webGLRenderTargetSet.iterate((function(t){e.releaseImp(t)})),this._webGLRenderTargetSet.clear()}_directDraw({drawMode:e,start:t,count:r,hasIndices:n,instanceCount:i}){i>1?n?this._gl.drawElementsInstanced(e,r,this._currentBoundIndexBuffer._glType,t*this._currentBoundIndexBuffer._typeSize,i):this._gl.drawArraysInstanced(e,t,r,i):n?this._gl.drawElements(e,r,this._currentBoundIndexBuffer._glType,t*this._currentBoundIndexBuffer._typeSize):this._gl.drawArrays(e,t,r)}blendFuncSeparate({srcRGB:e,dstRGB:t,srcAlpha:r,dstAlpha:n}){this._gl.blendFuncSeparate(e,t,r,n)}setStates(e){Object.keys(e).filter((e=>!!this[e])).forEach((t=>{this[t].bind(this)(e[t])}))}}},{"./AttributeNames":1,"./DataTexture":4,"./Program":10,"./ProgramUniform":11,"./ShaderProcess":13,"./Texture":15,"./WebGLCompatibility":19,"./WebGLConstants":20,"./WebGLHandlerSet":22,"./WebGLUtils":23,"./math/Math":26,"./math/Vec4":29}],22:[function(e,t,r){t.exports=class{constructor(e=null){this._handlerSet={},this._initialize=e}reset(e){var t={};return this._initialize&&this._initialize(t),this._handlerSet[e._id]=t,t}get(e){var t=this._handlerSet[e._id];return t||this.reset(e)}getById(e){var t=this._handlerSet[e];return t||this.reset(t)}find(e){return this._handlerSet[e._id]}remove(e){delete this._handlerSet[e._id]}clear(){this._handlerSet={}}iterate(e){for(var t in _handlerSet)e(_handlerSet[t])}}},{}],23:[function(e,t,r){var n,i,s,a=(n=!0,i=function(e,t,r){for(var n=null,i=0;i<r.length;++i){try{n=e.getContext(r[i],t)}catch(e){window.console.log(e)}if(n)break}return n},{create3DContext:s=function(e,t){var r;if(t&&t.webgl2){if(n=!1,r=i(e,t,["webgl2","experimental-webgl2"]))return r;n=!0}return i(e,t,["webgl","experimental-webgl","webkit-3d","moz-webgl"])},setupWebGL:function(e,t,r){r=r||function(e){if(n){var t=document.getElementsByTagName("body")[0];if(t){var r=window.WebGLRenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';e&&(r+="<br/><br/>Status: "+e),t.innerHTML=function(e){return'<div style="margin: auto width:500pxz-index:10000margin-top:20emtext-align:center">'+e+"</div>"}(r)}}},e.addEventListener&&e.addEventListener("webglcontextcreationerror",(function(e){r(e.statusMessage)}),!1);var i=s(e,t);return i||r(""),i}});t.exports=a},{}],24:[function(e,t,r){const n=e("load-asset"),i=e("../Texture");t.exports=async e=>{const t=await n.all(e);for(key in t)t[key]=new i({source:t[key],mipMaping:!1,flipY:!1});return t}},{"../Texture":15,"load-asset":37}],25:[function(e,t,r){const n=e("./Math"),i=e("./Vec3");t.exports=class e{constructor(){this.data=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._x,this._y,this._z,this._mat4,this._vec3}set(e,t,r,n,i,s,a,o,_,h,l,u,c,E,T,d){var f=this.data;return f[0]=e,f[4]=t,f[8]=r,f[12]=n,f[1]=i,f[5]=s,f[9]=a,f[13]=o,f[2]=_,f[6]=h,f[10]=l,f[14]=u,f[3]=c,f[7]=E,f[11]=T,f[15]=d,this}setFromArray(e){return this.data.set(e),this}makeIdentity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new e).copy(this)}copy(e){return this.data.set(e.data),this}rotateByEuler(e,t,r,n){n=n||"XYZ";var i,s,a,o,_,h,l,u,c,E,T,d,f=Math.cos(e),R=Math.sin(e),A=Math.cos(t),p=Math.sin(t),m=Math.cos(r),v=Math.sin(r),g=this.data;return"XYZ"===n?(_=f*m,h=f*v,l=R*m,u=R*v,g[0]=A*m,g[4]=-A*v,g[8]=p,g[1]=h+l*p,g[5]=_-u*p,g[9]=-R*A,g[2]=u-_*p,g[6]=l+h*p,g[10]=f*A):"YXZ"===n?(i=A*m,s=A*v,a=p*m,o=p*v,g[0]=i+o*R,g[4]=a*R-s,g[8]=f*p,g[1]=f*v,g[5]=f*m,g[9]=-R,g[2]=s*R-a,g[6]=o+i*R,g[10]=f*A):"ZXY"===n?(i=A*m,s=A*v,a=p*m,o=p*v,g[0]=i-o*R,g[4]=-f*v,g[8]=a+s*R,g[1]=s+a*R,g[5]=f*m,g[9]=o-i*R,g[2]=-f*p,g[6]=R,g[10]=f*A):"ZYX"===n?(_=f*m,h=f*v,l=R*m,u=R*v,g[0]=A*m,g[4]=l*p-h,g[8]=_*p+u,g[1]=A*v,g[5]=u*p+_,g[9]=h*p-l,g[2]=-p,g[6]=R*A,g[10]=f*A):"YZX"===n?(c=f*A,E=f*p,T=R*A,d=R*p,g[0]=A*m,g[4]=d-c*v,g[8]=T*v+E,g[1]=v,g[5]=f*m,g[9]=-R*m,g[2]=-p*m,g[6]=E*v+T,g[10]=c-d*v):"XZY"===n&&(c=f*A,E=f*p,T=R*A,d=R*p,g[0]=A*m,g[4]=-v,g[8]=p*m,g[1]=c*v+d,g[5]=f*m,g[9]=E*v-T,g[2]=T*v-E,g[6]=R*m,g[10]=d*v+c),g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}rotateByQuat(e){var t=this.data,r=e.x,n=e.y,i=e.z,s=e.w,a=r+r,o=n+n,_=i+i,h=r*a,l=r*o,u=r*_,c=n*o,E=n*_,T=i*_,d=s*a,f=s*o,R=s*_;return t[0]=1-(c+T),t[4]=l-R,t[8]=u+f,t[1]=l+R,t[5]=1-(h+T),t[9]=E-d,t[2]=u-f,t[6]=E+d,t[10]=1-(h+c),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}setFromMat3(e){var t=e.data;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}calcNormalMat3(e){return e.setFromMat4(this),e.calcInverse(e),e.transpose(),e}lookAt(e,t,r){void 0===this._x&&(this._x=new i),void 0===this._y&&(this._y=new i),void 0===this._z&&(this._z=new i);var n=this._x,s=this._y,a=this._z,o=this.data;return e.subTo(t,a).normalize(),0===a.squaredLength()&&(a.z=1),r.crossTo(a,n),0===n.squaredLength()&&(1===Math.abs(r.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),r.crossTo(a,n)),n.normalize(),a.crossTo(n,s),o[0]=n.x,o[4]=s.x,o[8]=a.x,o[1]=n.y,o[5]=s.y,o[9]=a.y,o[2]=n.z,o[6]=s.z,o[10]=a.z,this}getRawFrustum(){var e=this.data;if(0!==e[3]||0!==e[7]||-1!==e[11]||0!==e[15])throw Error("matrix cant getRawFrustum");var t=e[14]/(e[10]-1),r=e[14]/(1+e[10]);return{left:t*(e[8]-1)/e[0],right:t*(1+e[8])/e[0],top:t*(1+e[9])/e[5],bottom:t*(e[9]-1)/e[5],near:t,far:r}}buildByFrustum(e,t,r,n,i,s){var a=this.data,o=2*i/(t-e),_=2*i/(n-r),h=(t+e)/(t-e),l=(n+r)/(n-r),u=-(s+i)/(s-i),c=-2*s*i/(s-i);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=_,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=c,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}mul(e){return this.mulTo(e,this)}mulTo(e,t){var r=this.data,n=e.data,i=t.data,s=r[0],a=r[4],o=r[8],_=r[12],h=r[1],l=r[5],u=r[9],c=r[13],E=r[2],T=r[6],d=r[10],f=r[14],R=r[3],A=r[7],p=r[11],m=r[15],v=n[0],g=n[4],S=n[8],I=n[12],M=n[1],N=n[5],x=n[9],b=n[13],F=n[2],L=n[6],y=n[10],C=n[14],O=n[3],B=n[7],w=n[11],D=n[15];return i[0]=s*v+a*M+o*F+_*O,i[4]=s*g+a*N+o*L+_*B,i[8]=s*S+a*x+o*y+_*w,i[12]=s*I+a*b+o*C+_*D,i[1]=h*v+l*M+u*F+c*O,i[5]=h*g+l*N+u*L+c*B,i[9]=h*S+l*x+u*y+c*w,i[13]=h*I+l*b+u*C+c*D,i[2]=E*v+T*M+d*F+f*O,i[6]=E*g+T*N+d*L+f*B,i[10]=E*S+T*x+d*y+f*w,i[14]=E*I+T*b+d*C+f*D,i[3]=R*v+A*M+p*F+m*O,i[7]=R*g+A*N+p*L+m*B,i[11]=R*S+A*x+p*y+m*w,i[15]=R*I+A*b+p*C+m*D,t}scale(e){var t=this.data;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}mulScale(e){var t=this.data,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this}det(){var e=this.data,t=e[0],r=e[4],n=e[8],i=e[12],s=e[1],a=e[5],o=e[9],_=e[13],h=e[2],l=e[6],u=e[10],c=e[14];return e[3]*(+i*o*l-n*_*l-i*a*u+r*_*u+n*a*c-r*o*c)+e[7]*(+t*o*c-t*_*u+i*s*u-n*s*c+n*_*h-i*o*h)+e[11]*(+t*_*l-t*a*c-i*s*l+r*s*c+i*a*h-r*_*h)+e[15]*(-n*a*h-t*o*l+t*a*u+n*s*l-r*s*u+r*o*h)}transpose(){var e,t=this.data;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setTranslation(e){var t=this.data;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}getTranslation(e){return e.x=this.data[12],e.y=this.data[13],e.z=this.data[14],e}getEulerRotation(e,t){e||(e=new i);var r,s,a,o=n.clamp,_=this.data,h=_[0],l=_[4],u=_[8],c=_[1],E=_[5],T=_[9],d=_[2],f=_[6],R=_[10];return"XYZ"===t?(s=Math.asin(o(u,-1,1)),Math.abs(u)<.99999?(r=Math.atan2(-T,R),a=Math.atan2(-l,h)):(r=Math.atan2(f,E),a=0)):"YXZ"===t?(r=Math.asin(-o(T,-1,1)),Math.abs(T)<.99999?(s=Math.atan2(u,R),a=Math.atan2(c,E)):(s=Math.atan2(-d,h),a=0)):"ZXY"===t?(r=Math.asin(o(f,-1,1)),Math.abs(f)<.99999?(s=Math.atan2(-d,R),a=Math.atan2(-l,E)):(s=0,a=Math.atan2(c,h))):"ZYX"===t?(s=Math.asin(-o(d,-1,1)),Math.abs(d)<.99999?(r=Math.atan2(f,R),a=Math.atan2(c,h)):(r=0,a=Math.atan2(-l,E))):"YZX"===t?(a=Math.asin(o(c,-1,1)),Math.abs(c)<.99999?(r=Math.atan2(-T,E),s=Math.atan2(-d,h)):(r=0,s=Math.atan2(u,R))):"XZY"===t&&(a=Math.asin(-o(l,-1,1)),Math.abs(l)<.99999?(r=Math.atan2(f,E),s=Math.atan2(u,h)):(r=Math.atan2(-T,R),s=0)),e.set(r,s,a),e}calcInverse(e){var t=e.data,r=this.data,n=r[0],i=r[1],s=r[2],a=r[3],o=r[4],_=r[5],h=r[6],l=r[7],u=r[8],c=r[9],E=r[10],T=r[11],d=r[12],f=r[13],R=r[14],A=r[15],p=c*R*l-f*E*l+f*h*T-_*R*T-c*h*A+_*E*A,m=d*E*l-u*R*l-d*h*T+o*R*T+u*h*A-o*E*A,v=u*f*l-d*c*l+d*_*T-o*f*T-u*_*A+o*c*A,g=d*c*h-u*f*h-d*_*E+o*f*E+u*_*R-o*c*R,S=n*p+i*m+s*v+a*g;if(0===S){return window.window.console.warn("Mat4.calcInverse: det is 0"),this.makeIdentity()}return t[0]=p,t[1]=f*E*a-c*R*a-f*s*T+i*R*T+c*s*A-i*E*A,t[2]=_*R*a-f*h*a+f*s*l-i*R*l-_*s*A+i*h*A,t[3]=c*h*a-_*E*a-c*s*l+i*E*l+_*s*T-i*h*T,t[4]=m,t[5]=u*R*a-d*E*a+d*s*T-n*R*T-u*s*A+n*E*A,t[6]=d*h*a-o*R*a-d*s*l+n*R*l+o*s*A-n*h*A,t[7]=o*E*a-u*h*a+u*s*l-n*E*l-o*s*T+n*h*T,t[8]=v,t[9]=d*c*a-u*f*a-d*i*T+n*f*T+u*i*A-n*c*A,t[10]=o*f*a-d*_*a+d*i*l-n*f*l-o*i*A+n*_*A,t[11]=u*_*a-o*c*a-u*i*l+n*c*l+o*i*T-n*_*T,t[12]=g,t[13]=u*f*s-d*c*s+d*i*E-n*f*E-u*i*R+n*c*R,t[14]=d*_*s-o*f*s-d*i*h+n*f*h+o*i*R-n*_*R,t[15]=o*c*s-u*_*s+u*i*h-n*c*h-o*i*E+n*_*E,e.scale(1/S)}rotateX(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}rotateY(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}rotateZ(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}rotateByAxisRadian(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,s=e.x,a=e.y,o=e.z,_=i*s,h=i*a;return this.set(_*s+r,_*a-n*o,_*o+n*a,0,_*a+n*o,h*a+r,h*o-n*s,0,_*o-n*a,h*o+n*s,i*o*o+r,0,0,0,0,1),this}compose(e,t,r){return this.rotateByQuat(t),this.mulScale(r),this.setTranslation(e),this}decompose(t,r,n){void 0===this._vec3&&(this._vec3=new i),void 0===this._mat4&&(this._mat4=new e);var s=this._vec3,a=this._mat4,o=this.data,_=s.set(o[0],o[1],o[2]).length(),h=s.set(o[4],o[5],o[6]).length(),l=s.set(o[8],o[9],o[10]).length();this.det()<0&&(_=-_),t.x=o[12],t.y=o[13],t.z=o[14],a.data.set(this.data);var u=1/_,c=1/h,E=1/l;return a.data[0]*=u,a.data[1]*=u,a.data[2]*=u,a.data[4]*=c,a.data[5]*=c,a.data[6]*=c,a.data[8]*=E,a.data[9]*=E,a.data[10]*=E,r.buildByMat(a),n.x=_,n.y=h,n.z=l,this}buildPerspective(e,t,r,i){var s=r*Math.tan(n.deg2Rad(.5*e)),a=-s,o=a*t,_=s*t;return this.buildByFrustum(o,_,a,s,r,i)}buildOrtho(e,t,r,n,i,s){var a=this.data,o=1/(t-e),_=1/(r-n),h=1/(s-i),l=(t+e)*o,u=(r+n)*_,c=(s+i)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*_,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){for(var t=this.data,r=e.data,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0}}},{"./Math":26,"./Vec3":28}],26:[function(e,t,r){const n=e("./Vec3");var i={guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},log2:function(e){return Math.log(e)/Math.log(2)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},rand:function(e,t){return e+Math.random()*(t-e)},randVec3:function(e,t){return new n(this.rand(e,t),this.rand(e,t),this.rand(e,t))},flip:function(){return Math.random()>=.5},randFloat:function(e,t){return e+Math.random()*(t-e)},deg2Rad:function(e){return e*Math.PI/180},rad2Deg:function(e){return 180*e/Math.PI},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},mix:function(e,t,r){return e*(1-r)+t*r},hash:function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t},smoothStep:function(e,t,r){if(r<=e)return 0;if(r>=t)return 1;var n=(r-e)/(t-e);return n*n*(3-2*n)}};t.exports=i},{"./Vec3":28}],27:[function(e,t,r){t.exports=class e{constructor(e,t){this.x=e||0,this.y=t||0}set(e,t){return this.x=e,this.y=t,this}setFromArray(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}clone(){return(new e).copy(this)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subTo(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){return this.x*=e.x,this.y*=e.y,this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}squaredLength(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}scale(e){return this.x*=e,this.y*=e,this}squaredDistance(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r}normalize(){return this.scale(1/this.length())}equals(e){return e.x===this.x&&e.y===this.y}transformByMat3(e){var t=this.x,r=this.y,n=e.data;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}}},{}],28:[function(e,t,r){var n;class i{constructor(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}set(e,t,r){return this.x=e,this.y=t,this.z=r,this}clone(){return(new i).copy(this)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addTo(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t}buildFromSpherical(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}projectToPlane(e){return void 0===n&&(n=new i),n.copy(e.normal),this.sub(n.scale(this.dot(n))),this}applyProjection(e){var t=this.x,r=this.y,n=this.z,i=e.data,s=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*s,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subTo(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t}scale(e){return this.x*=e,this.y*=e,this.z*=e,this}transformByMat3(e){var t=this.x,r=this.y,n=this.z,i=e.data;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}transformByMat4(e){var t=this.x,r=this.y,n=this.z,i=e.data;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this}transformByMat4To(e,t){var r=this.x,n=this.y,i=this.z,s=e.data;t.x=s[0]*r+s[4]*n+s[8]*i+s[12],t.y=s[1]*r+s[5]*n+s[9]*i+s[13],t.z=s[2]*r+s[6]*n+s[10]*i+s[14]}transformByQuat(e){var t=this.x,r=this.y,n=this.z,i=e.x,s=e.y,a=e.z,o=e.w,_=o*t+s*n-a*r,h=o*r+a*t-i*n,l=o*n+i*r-s*t,u=-i*t-s*r-a*n;return this.x=_*o+u*-i+h*-a-l*-s,this.y=h*o+u*-s+l*-i-_*-a,this.z=l*o+u*-a+_*-s-h*-i,this}setFromArray(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}setFromMat4Column(e,t){return this.setFromArray(e.data,4*t)}inverse(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}mul(e){return this.x=this.x*e.x,this.y=this.y*e.y,this.z=this.z*e.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}squaredLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){return this.scale(1/this.length())}setLength(e){return this.scale(e/this.length())}mixBy(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}mix2(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this}crossTo(e,t){var r=this.x,n=this.y,i=this.z,s=e.x,a=e.y,o=e.z;return t.x=n*o-i*a,t.y=i*s-r*o,t.z=r*a-n*s,t}distance(e){return Math.sqrt(this.squaredDistance(e))}distanceToPlane(e){return this.dot(e.normal)+e.distanceToOrigin}squaredDistance(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}i.One=function(){return new i(1,1,1)},i.Zero=function(){return new i(0,0,0)},i.AxisZ=function(){return new i(0,0,1)},i.AxisX=function(){return new i(1,0,0)},i.AxisY=function(){return new i(0,1,0)},t.exports=i},{}],29:[function(e,t,r){t.exports=class e{constructor(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0===n?1:n}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}clone(){return(new e).copy(this)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}scale(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}}},{}],30:[function(e,t,r){var n=e("./mime-types.json"),i={};Object.keys(n).forEach((function(e){n[e].forEach((function(t){i[t]=e}))})),t.exports=function(e){if(!e)throw new TypeError("must specify extension string");return 0===e.indexOf(".")&&(e=e.substring(1)),i[e.toLowerCase()]}},{"./mime-types.json":31}],31:[function(e,t,r){t.exports={"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a","m4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/webm":["weba"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/wav":["wav"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"]}},{}],32:[function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function s(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,n,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new a(r,n||e,s),_=i?i+t:t;return e._events[_]?e._events[_].fn?e._events[_]=[e._events[_],o]:e._events[_].push(o):(e._events[_]=o,e._eventsCount++),e}function _(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function h(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),h.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},h.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,s=r.length,a=new Array(s);n<s;n++)a[n]=r[n].fn;return a},h.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},h.prototype.emit=function(e,t,r,n,s,a){var o=i?i+e:e;if(!this._events[o])return!1;var _,h,l=this._events[o],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,s),!0;case 6:return l.fn.call(l.context,t,r,n,s,a),!0}for(h=1,_=new Array(u-1);h<u;h++)_[h-1]=arguments[h];l.fn.apply(l.context,_)}else{var c,E=l.length;for(h=0;h<E;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,r);break;case 4:l[h].fn.call(l[h].context,t,r,n);break;default:if(!_)for(c=1,_=new Array(u-1);c<u;c++)_[c-1]=arguments[c];l[h].fn.apply(l[h].context,_)}}return!0},h.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},h.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},h.prototype.removeListener=function(e,t,r,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return _(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||_(this,s);else{for(var o=0,h=[],l=a.length;o<l;o++)(a[o].fn!==t||n&&!a[o].once||r&&a[o].context!==r)&&h.push(a[o]);h.length?this._events[s]=1===h.length?h[0]:h:_(this,s)}return this},h.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&_(this,t)):(this._events=new s,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=i,h.EventEmitter=h,void 0!==t&&(t.exports=h)},{}],33:[function(e,t,r){(function(e){(function(){var r;r="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=r}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,t,r){t.exports=function(e){"string"==typeof e&&(e=[e]);for(var t=[].slice.call(arguments,1),r=[],n=0;n<e.length-1;n++)r.push(e[n],t[n]||"");return r.push(e[n]),r.join("")}},{}],35:[function(e,t,r){t.exports=function(e){if(!e)return!1;var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString},{}],36:[function(e,t,r){function n(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}t.exports=n,t.exports.default=n},{}],37:[function(e,t,r){var n=e("./loaders"),i=e("object-assign"),s=e("is-promise"),a=function(){};function o(e,t,r){if("function"!=typeof(t=t||a))return Promise.reject(new Error("The second argument to load.all() and load.any() must be a function, or undefined"));var n,i,s=0,o=function(e,r,i,s){var a={target:e,total:n,count:i,progress:i/n,value:r};s&&(a.error=s),t(a)};if(i=r?function(e){return _(e).then((function(e){return{value:e}}),(function(e){return{value:null,error:e}})).then((function(t){return o(e,t.value,++s,t.error),t.value}))}:function(e){return _(e).then((function(t){return o(e,t,++s),t}))},Array.isArray(e))return n=e.length,Promise.all(e.map((function(e){return i(e)})));if(e){var h=Object.keys(e).map((function(t){return{key:t,value:e[t]}}));return n=h.length,Promise.all(h.map((function(e){var t=e.key;return i(e.value).then((function(e){return{value:e,key:t}}))}))).then((function(e){return e.reduce((function(e,t){return e[t.key]=t.value,e}),{})}))}return Promise.reject(new Error("You must specify an array of assets or object group to load"))}function _(e){return e?("string"==typeof e&&(e={url:e}),s(e)?e:function(e){var t,r,i=e.type?e.type:null;if(i){if("function"==typeof i)return Promise.resolve(i);if(i=i.toLowerCase(),!e.url)return Promise.reject(new Error("When using loadAsset(), you must specify a URL or descriptor of the asset to load"));for(t=0;t<n.length;t++)if((r=n[t]).key===i)return Promise.resolve(r.load);return Promise.reject(new Error('Could not find an asset loader by the key "'+e.type+'"'))}if(!e.url)return Promise.reject(new Error("When using loadAsset(), you must specify a URL or descriptor of the asset to load"));var s=function(e){if(!e)return"";var t=e.lastIndexOf("/");-1!==t&&(e=e.substring(t+1));-1!==(t=e.indexOf("?"))&&(e=e.substring(0,t));-1!==(t=e.indexOf("#"))&&(e=e.substring(0,t));return-1!==(t=e.lastIndexOf("."))?e.substring(t):""}(e.url);if(!s)return Promise.reject(new Error('No extension found for input URL "'+e.url+'", try to specify a { type } such as "image" or "text"'));for(t=0;t<n.length;t++){if((r=n[t]).match)if("function"==typeof r.match?r.match(s):r.match.test(s))return Promise.resolve(r.load)}return Promise.reject(new Error('Could not infer an asset loader from the file type "'+s+'", try specifying { type } such as "image" or "text"'))}(e).then((function(t){return delete(e=i({},e)).type,t(e)}))):Promise.reject(new Error("You must specify a URL or descriptor of the asset to load"))}t.exports=_,t.exports.all=function(e,t){return o(e,t,!1)},t.exports.any=function(e,t){return o(e,t,!0)}},{"./loaders":40,"is-promise":36,"object-assign":42}],38:[function(e,t,r){var n=e("xhr"),i=e("object-assign");t.exports=function(e){return function(t){return("fetch"in window?window.fetch(t.url,t).then((function(t){if(/404/.test(t.status))throw new Error("Resource not found");if(!/^2/.test(t.status))throw new Error("Unexpected HTTP Status Code: "+t.status);if(!t.ok)throw new Error("Response not OK");return"json"===e?t.json():"binary"===e?t.arrayBuffer():"blob"===e?t.blob():t.text()})):function(e,t){return new Promise((function(r,s){var a="text";"json"===e?a="text":"binary"===e?a="arraybuffer":"blob"===e&&(a="blob"),t=i({},t,{json:!1,responseType:a}),n(t,(function(t,n,i){if(t)return s(t);if(/404/.test(n.statusCode))throw new Error("Resource not found");if(!/^2/.test(n.statusCode))return s(new Error("Unexpected HTTP Status Code: "+n.statusCode));if("json"===e)try{i=JSON.parse(i)}catch(t){return s(t)}r(i)}))}))}(e,t)).catch((function(e){throw new Error(e.message+" while loading file "+t.url)}))}}},{"object-assign":42,xhr:45}],39:[function(e,t,r){var n=e("browser-media-mime-type");t.exports=function(e,t){return{key:e,match:function(t){return function(e){var t=n(e);return t?0===t.indexOf("audio")?"audio":0===t.indexOf("video")?"video":null:null}(t)===e},load:function(r){return new Promise((function(n,i){var s=!1,a=t(),o=function(){s||(s=!0,n(a))},_=(r.event||"canplay").toLowerCase();if("loadedmetadata"===_?a.onloadedmetadata=o:"canplaythrough"===_?a.oncanplaythrough=o:"loadeddata"===_?a.onloadeddata=o:a.oncanplay=o,a.onerror=function(t){s||(s=!0,i(new Error("Error while loading "+e+" at "+r.url)))},r.crossOrigin&&(a.crossOrigin=r.crossOrigin),void 0!==r.volume&&(a.volume=r.volume),void 0!==r.preload&&(a.preload=r.volume),void 0!==r.playbackRate&&(a.playbackRate=r.volume),void 0!==r.muted&&(a.muted=r.volume),void 0!==r.currentTime&&(a.currentTime=r.volume),void 0!==r.controls&&(a.controls=r.volume),void 0!==r.autoPlay&&(a.autoPlay=r.volume),a.src=r.url,a.readyState>=a.HAVE_ENOUGH_DATA)return s=!0,n(a);a.load()}))}}}},{"browser-media-mime-type":30}],40:[function(e,t,r){const n=e("./createMediaLoader"),i=e("./createFileLoader"),s=e("./loadImage");t.exports=[{key:"json",match:/\.json$/i,load:i("json")},{key:"text",match:/\.txt$/i,load:i("text")},{key:"image",match:/\.(jpg|jpeg|svg|png|gif|webp|bmp|tga|tif|apng|wbpm|ico)$/i,load:s},n("audio",(function(){return new window.Audio})),n("video",(function(){return document.createElement("video")})),{key:"binary",match:/\.bin$/i,load:i("binary")},{key:"blob",load:i("blob")}]},{"./createFileLoader":38,"./createMediaLoader":39,"./loadImage":41}],41:[function(e,t,r){t.exports=function(e){return new Promise((function(t,r){var n=!1,i=new window.Image;i.onload=function(){n||(n=!0,t(i))},i.onerror=function(){n||(n=!0,r(new Error("Error while loading image at "+e.url)))},e.crossOrigin&&(i.crossOrigin=e.crossOrigin),i.src=e.url}))}},{}],42:[function(e,t,r){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,o,_=a(e),h=1;h<arguments.length;h++){for(var l in r=Object(arguments[h]))i.call(r,l)&&(_[l]=r[l]);if(n){o=n(r);for(var u=0;u<o.length;u++)s.call(r,o[u])&&(_[o[u]]=r[o[u]])}}return _}},{}],43:[function(e,t,r){var n=function(e){return e.replace(/^\s+|\s+$/g,"")};t.exports=function(e){if(!e)return{};for(var t,r={},i=n(e).split("\n"),s=0;s<i.length;s++){var a=i[s],o=a.indexOf(":"),_=n(a.slice(0,o)).toLowerCase(),h=n(a.slice(o+1));void 0===r[_]?r[_]=h:(t=r[_],"[object Array]"===Object.prototype.toString.call(t)?r[_].push(h):r[_]=[r[_],h])}return r}},{}],44:[function(e,t,r){var n,i;n=this,i=function(){"use strict";var e=function(){var t=0,r=document.createElement("div");function n(e){return r.appendChild(e.dom),e}function i(e){for(var n=0;n<r.children.length;n++)r.children[n].style.display=n===e?"block":"none";t=e}r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(e){e.preventDefault(),i(++t%r.children.length)}),!1);var s=(performance||Date).now(),a=s,o=0,_=n(new e.Panel("FPS","#0ff","#002")),h=n(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:r,addPanel:n,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(h.update(e-s,200),a+1e3<=e&&(_.update(1e3*o/(e-a),100),a=e,o=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:r,setMode:i}};return e.Panel=function(e,t,r){var n=1/0,i=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,_=48*a,h=3*a,l=2*a,u=3*a,c=15*a,E=74*a,T=30*a,d=document.createElement("canvas");d.width=o,d.height=_,d.style.cssText="width:80px;height:48px";var f=d.getContext("2d");return f.font="bold "+9*a+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=r,f.fillRect(0,0,o,_),f.fillStyle=t,f.fillText(e,h,l),f.fillRect(u,c,E,T),f.fillStyle=r,f.globalAlpha=.9,f.fillRect(u,c,E,T),{dom:d,update:function(_,R){n=Math.min(n,_),i=Math.max(i,_),f.fillStyle=r,f.globalAlpha=1,f.fillRect(0,0,o,c),f.fillStyle=t,f.fillText(s(_)+" "+e+" ("+s(n)+"-"+s(i)+")",h,l),f.drawImage(d,u+a,c,E-a,T,u,c,E-a,T),f.fillRect(u+E-a,c,a,T),f.fillStyle=r,f.globalAlpha=.9,f.fillRect(u+E-a,c,a,s((1-_/R)*T))}}},e},"object"==typeof r&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):n.Stats=i()},{}],45:[function(e,t,r){"use strict";var n=e("global/window"),i=e("is-function"),s=e("parse-headers"),a=e("xtend");function o(e,t,r){var n=e;return i(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=a(t,{uri:e}),n.callback=r,n}function _(e,t,r){return h(t=o(e,t,r))}function h(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,n,i){t||(t=!0,e.callback(r,n,i))};function n(){var e=void 0;if(e=l.response?l.response:l.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(l),R)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(u),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,A)}function a(){if(!h){var t;clearTimeout(u),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var i=A,a=null;return 0!==t?(i={body:n(),statusCode:t,method:E,headers:{},url:c,rawRequest:l},l.getAllResponseHeaders&&(i.headers=s(l.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),r(a,i,i.body)}}var o,h,l=e.xhr||null;l||(l=e.cors||e.useXDR?new _.XDomainRequest:new _.XMLHttpRequest);var u,c=l.url=e.uri||e.url,E=l.method=e.method||"GET",T=e.body||e.data,d=l.headers=e.headers||{},f=!!e.sync,R=!1,A={body:void 0,headers:{},statusCode:0,method:E,url:c,rawRequest:l};if("json"in e&&!1!==e.json&&(R=!0,d.accept||d.Accept||(d.Accept="application/json"),"GET"!==E&&"HEAD"!==E&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),T=JSON.stringify(!0===e.json?T:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(a,0)},l.onload=a,l.onerror=i,l.onprogress=function(){},l.onabort=function(){h=!0},l.ontimeout=i,l.open(E,c,!f,e.username,e.password),f||(l.withCredentials=!!e.withCredentials),!f&&e.timeout>0&&(u=setTimeout((function(){if(!h){h=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}}),e.timeout)),l.setRequestHeader)for(o in d)d.hasOwnProperty(o)&&l.setRequestHeader(o,d[o]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(T||null),l}t.exports=_,t.exports.default=_,_.XMLHttpRequest=n.XMLHttpRequest||function(){},_.XDomainRequest="withCredentials"in new _.XMLHttpRequest?_.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],(function(e){_["delete"===e?"del":e]=function(t,r,n){return(r=o(t,r,n)).method=e.toUpperCase(),h(r)}}))},{"global/window":33,"is-function":35,"parse-headers":43,xtend:46}],46:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}],47:[function(e,t,r){(function(t){(function(){const r=e("../WebGLCanvas"),n=e("../StopWatch"),i=e("../RenderTarget"),s=e("../loader/texture"),a=e("../WebGLConstants"),o=e("../BigTriangle"),_=e("glslify"),h=e("stats-js"),l=document.getElementById("canvas"),u="#version 300 es\n    precision highp float;\n    in vec2 position;\n    void main() {\n        gl_Position = vec4(position.xy, 0.0, 1.0);\n}";!async function(){let e=0,c=0,E=5,T=0,d=INITIAL_SPEED,f=[1,1,1],R=new Slider(document.getElementById("speed-slider"),1,MAX_SPEED,INITIAL_SPEED,(function(t){d=t,e=0})),A=new Slider(document.getElementById("intensity-slider"),0,8,5,(function(t){E=t,e=0})),p=new Buttons([document.getElementById("LAMBERT"),document.getElementById("METAL"),document.getElementById("GLASS"),document.getElementById("WOOD")],(function(t){c=t,e=0})),m=new Buttons([document.getElementById("1"),document.getElementById("2"),document.getElementById("3")],(function(t){T=t,e=0}));new HuePicker(document.getElementById("picker"),(function(t){e=0,f=hsvToRGB(t,UI_SATURATION,UI_VALUE);var r="rgb("+(255*f[0]).toFixed(0)+","+(255*f[1]).toFixed(0)+","+(255*f[2]).toFixed(0)+")";m.setColor(r),R.setColor(r),A.setColor(r),p.setColor(r)}));let v=o({vs:u,fs:_(['#version 300 es\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\nuniform vec2 size;\nuniform int frame;\nuniform float time;\n\nout vec4 fragColor;\n\nuniform sampler2D buffer;\n\nuniform int MAX_BOUNCES;\n\n#define MAX_DIST 1e20\n#define EPS 0.0001\n\nuint wang_hash(inout uint seed) {\n    seed = uint(seed ^ uint(61)) ^ uint(seed >> uint(16));\n    seed *= uint(9);\n    seed = seed ^ (seed >> 4);\n    seed *= uint(0x27d4eb2d);\n    seed = seed ^ (seed >> 15);\n    return seed;\n}\n\nfloat hash(inout uint state) {\n    return float(wang_hash(state)) / 4294967296.0;\n}\n\nvec2 hash2(inout uint state) {\n    return vec2(hash(state), hash(state));\n}\n\nconst float PI_0 = 3.14159265358979323846;\n\nstruct PerRayData {\n    float seed;\n    vec3 normal;\n    vec3 throughput;\n    vec3 rad; // radiance\n    vec3 wi; // bsdf dir\n    vec3 wo; // out dir\n    vec3 li; // light emissive radiance\n    vec3 li_pdf; // light pdf\n    bool light;  // is light    \n    vec3 hit;\n    int bounce;\n};\n\nstruct Ray {\n    vec3 o;\n    vec3 dir;    \n};\n\n#define QUAD_LIGHT 0\n#define DIR_LIGHT 1\n\nstruct Light {\n    int type;    \n    vec3 color; // 12\n    vec3 pos;   // 12\n    vec3 u; // 12\n    vec3 v; // 12\n    mat3 rotation;\n};\n\nconst float PI_1 = 3.14159265358979323846;\n\nRay camera_ray_3771232466(vec3 eye, vec3 tar, vec2 ndc) {\n    vec3 near = tar - eye;\n    float fov = 50.0;\n    vec3 dir = normalize(near);\n    vec3 u = normalize(cross(dir, vec3(0., 1., 0.))); // right\n    vec3 v = normalize(cross(u, dir)); // up\n\n    float vlen = length(near) * tan (fov * 0.5 * PI_1 / 180.);\n    float ulen = vlen * size.x / size.y;\n    dir = ndc.x * (u * ulen) + ndc.y * (v * vlen) + near;\n\n    Ray ray;\n    ray.o = eye;\n    ray.dir = normalize(dir);\n\n    return ray;\n}\n\n#define BSDF_REFLECTION 1 << 0\n#define BSDF_TRANSMISSION 1 << 1\n#define BSDF_DIFFUSE 1 << 2\n#define BSDF_GLOSSY 1 << 3\n#define BSDF_SPECULAR 1 << 4\n#define BSDF_ALL BSDF_DIFFUSE | BSDF_GLOSSY | BSDF_SPECULAR | BSDF_REFLECTION | BSDF_TRANSMISSION\n\nstruct Material {   \n    vec3 color; \n    float ior;\n    int type;\n};\n\nfloat intersect_1 (in vec3 ro_0, in vec3 rd_0, vec4 sph, in vec2 dist_bound_1677582278, inout vec3 normal_0) {\n    vec3 oc = ro_0 - sph.xyz;\n    float b = dot( oc, rd_0 );\n    float c = dot( oc, oc ) - sph.w*sph.w;\n    float h = b * b - c;\n    if (h < 0.) {\n        return MAX_DIST;\n    } else {\n\t    h = sqrt(h);\n        float d1 = -b-h;\n        float d2 = -b+h;\n        if (d1 >= dist_bound_1677582278.x && d1 <= dist_bound_1677582278.y) {\n            normal_0 = normalize(ro_0 + rd_0 * d1 - sph.xyz);\n            return d1;\n        } else if (d2 >= dist_bound_1677582278.x && d2 <= dist_bound_1677582278.y) { \n            normal_0 = normalize(ro_0 + rd_0 * d2 - sph.xyz);\n            return d2;\n        } else {\n            return MAX_DIST;\n        }\n    }\n}\n\nfloat intersect_3( in vec3 ro, in vec3 rd, in vec4 plane, in vec2 distBound, inout vec3 normal) {\n    float a = dot(rd, plane.xyz); // (a > 0) means backface\n    float d = -(dot(ro, plane.xyz) + plane.w) / a;\n    if (a > 0. || d < distBound.x || d > distBound.y) {\n        return MAX_DIST; // no intersection if back hit\n    } else {\n        normal = plane.xyz;\n    \treturn d;\n    }\n}\n\n// when ro inside the box, tN will be negative, return tF\n// box automactically flip normal\n\nfloat intersect_0(in vec3 ro, in vec3 rd, in vec3 boxSize, in vec2 distBound, inout vec3 normal) {\n    vec3 m = 1.0 / rd;\n    vec3 n = m * ro;\n    vec3 k = abs(m) * boxSize;\n\t\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\n\tfloat tN = max( max( t1.x, t1.y ), t1.z );\n\tfloat tF = min( min( t2.x, t2.y ), t2.z );\n\t\n    if (tN > tF || tF <= 0.) {\n        return MAX_DIST;\n    } else {\n        if (tN >= distBound.x && tN <= distBound.y) {  // if near < 0 means inside, only intersection at tF\n        \tnormal = -sign(rd)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\n            return tN;\n        } else if (tF >= distBound.x && tF <= distBound.y) { \n        \tnormal = -sign(rd)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\n            return tF;\n        } else {\n            return MAX_DIST;\n        }\n    }\n}\n/*\nfloat intersect(in vec3 ro, in vec3 rd, in vec3 boxSize, in vec2 distBound, inout vec3 normal) {\n    vec3 cubeMin = -boxSize;\n    vec3 cubeMax = boxSize;\n    vec3 tMin = (cubeMin - ro) / rd;\n    vec3 tMax = (cubeMax - ro) / rd;\n    vec3 t1 = min(tMin, tMax);\n    vec3 t2 = max(tMin, tMax);\n    float tNear = max(max(t1.x, t1.y), t1.z);\n    float tFar = min(min(t2.x, t2.y), t2.z);\n\n\n    vec3 hit;\n    float r;\n    \n    if (tNear > tFar) {\n        return MAX_DIST;\n    } else {\n        if (tNear >= distBound.x && tNear <= distBound.y) {  // if near < 0 means inside, only intersection at tF\n            r = tNear;\n        } else if (tFar >= distBound.x && tFar <= distBound.y) { \n            r = tFar;\n        } else {\n            return MAX_DIST;\n        }\n    } \n\n    hit = r * rd + ro;\n\n    if (hit.x < cubeMin.x + distBound.x) normal = vec3(-1.0, 0.0, 0.0);\n    else if (hit.x > cubeMax.x - distBound.x) normal = vec3(1.0, 0.0, 0.0);\n    else if (hit.y < cubeMin.y + distBound.x) normal = vec3(0.0, -1.0, 0.0);\n    else if (hit.y > cubeMax.y - distBound.x) normal = vec3(0.0, 1.0, 0.0);\n    else if (hit.z < cubeMin.z + distBound.x) normal =  vec3(0.0, 0.0, -1.0);\n    else normal = vec3(0.0, 0.0, 1.0);    \n\n    normal = -1. * normal;    \n\n    return r;\n}\n*/\n\n// Noteice that: cornel box intersection with back-face culling\n// always return tF in intersection, make sure every thing is inside this cornel box \n/*\nfloat intersect(in vec3 ro, in vec3 rd, in vec3 boxSize, in vec2 distBound, inout vec3 normal) {\n    vec3 m = sign(rd)/max(abs(rd), 1e-8);\n    vec3 n = m*ro;\n    vec3 k = abs(m)*boxSize;\t\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\tfloat tN = max( max( t1.x, t1.y ), t1.z );\n\tfloat tF = min( min( t2.x, t2.y ), t2.z );\t\n\n    if (tN > tF || tF <= 0.) {\n        return -1.;\n    } else {\n       if (tF >= distBound.x && tF <= distBound.y) { \n        \tnormal = -sign(rd)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\n            return tF;    \n        } else {\n            return -1.;\n        }\n    }    \n}\n*/\n\nfloat intersect_2(in vec3 ro, in vec3 rd, in vec3 boxSize, in vec2 distBound, inout vec3 normal) {\n    vec3 cubeMin = -boxSize;\n    vec3 cubeMax = boxSize;\n    vec3 tMin = (cubeMin - ro) / rd;\n    vec3 tMax = (cubeMax - ro) / rd;\n    vec3 t1 = min(tMin, tMax);\n    vec3 t2 = max(tMin, tMax);\n    float tNear = max(max(t1.x, t1.y), t1.z);\n    float tFar = min(min(t2.x, t2.y), t2.z);\n\n    if (tNear > tFar) return MAX_DIST;\n\n    vec3 hit;\n    float r;\n    \n    if (tFar >= distBound.x && tFar <= distBound.y) { \n        hit = tFar * rd + ro;\n        r = tFar;\n    } else {\n        return MAX_DIST;\n    }\n    if (hit.x < cubeMin.x + distBound.x) normal = vec3(-1.0, 0.0, 0.0);\n    else if (hit.x > cubeMax.x - distBound.x) normal = vec3(1.0, 0.0, 0.0);\n    else if (hit.y < cubeMin.y + distBound.x) normal = vec3(0.0, -1.0, 0.0);\n    else if (hit.y > cubeMax.y - distBound.x) normal = vec3(0.0, 1.0, 0.0);\n    else if (hit.z < cubeMin.z + distBound.x) normal =  vec3(0.0, 0.0, -1.0);\n    else normal = vec3(0.0, 0.0, 1.0);    \n\n    normal = -1. * normal;    \n\n    return r;\n}\n\nvoid make_coord_421267681(in vec3 N, inout vec3 T, inout vec3 B) {\n   if (abs(N.x) > abs(N.y)) \n        T = vec3(N.z, 0, -N.x) / sqrt(N.x * N.x + N.z * N.z); \n    else\n        T = vec3(0, -N.z, N.y) / sqrt(N.y * N.y + N.z * N.z); \n    // T is already normalized\n    B = cross(N, T); // conserve right hand\n}\n\nvoid cos_hemi_sample_2197045468(in vec2 rand, out vec3 p) {\n    // uniformly sample in a unit-disk.\n    float r  = sqrt(rand.x); // cos(theta), theta(0, PI / 2)\n    float phi = 2.0 * PI_0 * rand.y; // phi (0, 2 * PI)\n    p.x = r * cos(phi);\n    p.y = r * sin(phi);\n     // then project up to hemisphere.\n    p.z = sqrt(max(0.0, 1.0 - p.x * p.x - p.y * p.y));\n}\n\nvec3 eval_1(const vec3 N, const vec3 wo, const vec3 wi) {\n    float dot_wi_n = dot(wi, N);\n    if (dot_wi_n <= 0. || dot(wo, N) <= 0.) return vec3(0);\n    return vec3(dot_wi_n / PI_0);\n}\n\n// "sample" is revsered identify\nvec3 sample_f_1921068617(in vec2 rand, in vec3 N, vec3 wo, inout vec3 wi, inout float pdf) {\n    cos_hemi_sample_2197045468(rand, wi); // z up\n    vec3 T;\n    vec3 B;\n    make_coord_421267681(N, T, B);    \n    wi = wi.x * T + wi.y * B + wi.z * N;    \n    pdf = abs(dot(N, wi)) / PI_0;        \n    return eval_1(N, wo, wi);\n}\n\nfloat dielectric_fr_1460171947(float cosThetaI, float etaI, float etaT) {\n    cosThetaI = clamp(cosThetaI, -1., 1.);\n\n    // Potentially swap indices of refraction\n    bool entering = cosThetaI > 0.f;\n    if (!entering) {\n        float temp;\n        temp = etaI;\n        etaI = etaT;\n        etaT = temp;\n        cosThetaI = abs(cosThetaI);\n    }\n\n    // Compute _cosThetaT_ using Snell\'s law\n    float sinThetaI = sqrt(max(0., 1. - cosThetaI * cosThetaI));\n    float sinThetaT = etaI / etaT * sinThetaI;\n\n    // Handle total internal reflection\n    if (sinThetaT >= 1.) return 1.;\n    float cosThetaT = sqrt(max(0., 1. - sinThetaT * sinThetaT));\n    float Rparl = ((etaT * cosThetaI) - (etaI * cosThetaT)) /\n                  ((etaT * cosThetaI) + (etaI * cosThetaT));\n    float Rperp = ((etaI * cosThetaI) - (etaT * cosThetaT)) /\n                  ((etaI * cosThetaI) + (etaT * cosThetaT));\n    return (Rparl * Rparl + Rperp * Rperp) / 2.;\n}\n\nvec3 sample_f_4181093413(vec2 rand, vec3 N, vec3 wo, inout vec3 wi, inout float pdf) {    \n    float ior1 = 1.0;\n    float ior2 = 1.45;\n    vec3 reflect_color = vec3(1.0);\n    float F = dielectric_fr_1460171947(dot(N, wo), ior1, ior2);\n    F = 1.0;\n    bool entering = dot(wo, N) >= 0.0;\n    ior1 = entering? ior1: ior2;\n    ior2 = entering? ior2: ior1;\n    vec3 normal = entering? N : -N;\n\n    if (rand.x < F) {\n        pdf = F;\n        wi = reflect(-wo, normal);        \n        return vec3(F) * reflect_color;\n    } else {        \n        pdf = 1.0 - F;            \n        wi = refract(-wo, normal, ior1 / ior2);        \n        return vec3(1.0 - F) * reflect_color;\n    }\n}\n\nvec3 eval_0(const vec3 N, const vec3 wo, const vec3 wi) {\n    float dot_wi_n = dot(wi, N);\n    if (dot_wi_n <= 0. || dot(wo, N) <= 0.) return vec3(0);\n    return vec3(dot_wi_n / PI_0);\n}\n\nfloat pdf_0(in vec3 N, in vec3 wi) {\n    return abs(dot(N, wi)) / PI_0;\n}\n\nfloat sdBox( vec3 p, vec3 b ) {\n    vec3 q = abs(p) - b;\n    return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n}\n\nfloat sdCross( in vec3 p ) {\n    float da = sdBox(p.xyz,vec3(10000.,1.0,1.0));\n    float db = sdBox(p.yzx,vec3(1.0,10000.,1.0));\n    float dc = sdBox(p.zxy,vec3(1.0,1.0,10000.));\n    return min(da,min(db,dc));\n}\n\nfloat map( in vec3 p ) {\n\n    float d = sdBox(p,vec3(1.0));\n    float s = 1.0;\n    for( int m=0; m<3; m++ ) {\n        vec3 a = mod( p*s, 2.0 )-1.0;\n        s *= 3.0;\n        vec3 r = abs(1.0 - 3.0*abs(a));\n        float c = sdCross(r)/s;\n        d = max(d,-c);\n    }\n    return d;\n\n/*\n    float d = sdf_box(p,vec3(0.7));\n    float s = 1.0;\n    for( int m=0; m<4; m++ ) {\n        vec3 a = mod( p*s, 2.0 )-1.0;\n        s *= 3.0;\n        vec3 r = abs(1.0 - 3.0*abs(a));\n        float da = max(r.x,r.y);\n        float db = max(r.y,r.z);\n        float dc = max(r.z,r.x);\n        float c = (min(da,min(db,dc))-1.0)/s;\n        d = max(d,c);\n    }\n    return d;\n    */\n}\n\nvec3 normal_1( in vec3 pos ) {\n    vec3 eps = vec3(0.0001,0.0,0.0);\n    return normalize( vec3(\n      map( pos+eps.xyy ) - map( pos-eps.xyy ),\n      map( pos+eps.yxy ) - map( pos-eps.yxy ),\n      map( pos+eps.yyx ) - map( pos-eps.yyx ) ) );\n}\n\nfloat raymarch( in vec3 ro, in vec3 rd, inout vec3 normal ) {    \n    float res = -1.0;\n    float tmax = 3.;\n    float t = 0.01;\n    for (int i=0; i <45; i++) {\n        float h = map(ro+rd*t);\n        if( h<0.001 || t>tmax ) break;\n        t +=  h;\n    }    \n    if( t < tmax ) {\n        res = t;\n        normal = normal_1(ro + rd * t);\n    }\n    else res = MAX_DIST;\n    return res;\n}\n\n#define DIRECT_LIGHT_SAMPLE\n#define MI_SAMPLE\n\n#define LIGHT_NUM 3\nLight lights[LIGHT_NUM];\n\nconst vec3 colors[6] = vec3[6](\n    vec3(1),\n    vec3(0.9647, 0.5255, 0.9804),\n    vec3(0.3529, 0.9686, 0.8627),\n    vec3(0.4471, 0.4118, 0.9608),\n    vec3(0.8667, 0.6353, 0.1294),\n    vec3(1)\n);\n\nvec3 glass_sample_f(vec2 rand, vec3 N, vec3 wo, inout vec3 wi, inout float pdf) {    \n    float ior1 = 1.0;\n    float ior2 = 1.45;\n    vec3 reflect_color = vec3(1.0);\n    float F = dielectric_fr_1460171947(dot(N, wo), ior1, ior2);\n    \n    bool entering = dot(wo, N) >= 0.0;\n    ior1 = entering? ior1: ior2;\n    ior2 = entering? ior2: ior1;\n    vec3 normal = entering? N : -N;\n\n    if (rand.x < F) {\n        pdf = F;\n        wi = reflect(-wo, normal);        \n        return vec3(F) * reflect_color;\n    } else {        \n        pdf = 1.0 - F;            \n        wi = refract(-wo, normal, ior1 / ior2);        \n        return vec3(1.0 - F) * reflect_color;\n    }\n}\n\nvec3 metal_sample_f(vec2 rand, vec3 N, vec3 wo, inout vec3 wi, inout float pdf) {    \n    float ior1 = 1.0;\n    float ior2 = 1.45;\n    vec3 reflect_color = vec3(1.0);\n    bool entering = dot(wo, N) >= 0.0;\n    vec3 normal = entering? N : -N;\n    pdf = 1.0;\n    wi = reflect(-wo, normal);        \n    return reflect_color;    \n}\n\n// must be trace last\nbool trace_lights(in vec2 nearfar, in Ray ray, inout int light_id) {\n    vec3 normal;\n    light_id = -1;\n    for (int i = 0; i < LIGHT_NUM; i++) {\n        Light light = lights[i];\n        switch (light.type) {\n            case QUAD_LIGHT: \n                vec3 size = vec3((light.rotation * light.u).x, 0.0001, (light.rotation * light.v).z);\n                float t = intersect_0(light.rotation * (ray.o - light.pos), light.rotation * ray.dir, size, nearfar, normal);\n                if (t < nearfar.y) {\n                    light_id = i;\n                    nearfar.y = t;\n                } break;\n            case DIR_LIGHT: break;\n        }\n    }\n    return (light_id >= 0);\n}\n\nbool compare(inout vec2 nearfar, float t) {\n\tif (t < nearfar.y) {\n        nearfar = vec2(nearfar.x, t);\n        return true;\n    } \n    return false;\n}\n\n#define LAMBERT 0\n#define METAL_SPECULAR 1\n#define GLASS_SPECULAR 2\n#define WOOD 3\n\n#define SPHERE_POSITION vec4(-0.58, .4, .3, .4)\n\nfloat trace_shadow(vec2 near_far, in Ray ray) {\n    vec2 result = vec2(near_far); // near, far, hit_id\n    vec3 normal;\n    //result = compare(2., result, raymarch(ray.o + vec3(0, -1.0, 0), ray.dir, normal));\n\n    compare(result, intersect_1(ray.o, ray.dir, SPHERE_POSITION, result.xy, normal));\n    compare(result, intersect_1(ray.o, ray.dir, vec4(0.6, .4, -.6, .4),     result.xy, normal));\n    compare(result, intersect_1(ray.o, ray.dir, vec4(0.2, .2, 0.6, .2), result.xy, normal));\n    \n    return result.y;\n}\n\nuniform vec3 color;\nuniform int type;\nuniform float visible;\n\nfloat trace_ray(vec2 near_far, in Ray ray, inout PerRayData prd, inout Material material) {\n    vec2 result = near_far; // near, far, hit_id\n    if (compare(result, intersect_1(ray.o, ray.dir, SPHERE_POSITION, result.xy, prd.normal))) {\n        material.type = type;\n        material.color = vec3(1.0);\n    }\n\n    if (compare(result, intersect_1(ray.o, ray.dir, vec4(0.6, .4, -.6, .4), result.xy, prd.normal))) {\n        material.type = LAMBERT;\n        material.color =  vec3(0.851, 0.2235, 0.9333);\n    }          \n\n    if (compare(result, intersect_1(ray.o, ray.dir, vec4(.2, .2, 0.6, .2), result.xy, prd.normal))) {\n        material.type = METAL_SPECULAR;\n        material.color =vec3(1.0);\n    }\n\n    if (compare(result, intersect_3(ray.o, ray.dir,  vec4(0, 1, 0, 0), result.xy, prd.normal))) {\n        material.type = LAMBERT;\n        material.color = vec3(1.0);\n    } // bottom\n\n    if (compare(result, intersect_3(ray.o, ray.dir,  vec4(1, 0, 0, 1), result.xy, prd.normal))) {\n        material.type = METAL_SPECULAR;\n        material.color = vec3(1.0);\n    } // left \n\n    if (compare( result, intersect_3(ray.o, ray.dir,  vec4(-1, 0, 0, 1),  result.xy, prd.normal))) {\n        material.type = LAMBERT;\n        material.color = color;\n    } // right\n\n    if (compare(result, intersect_3(ray.o, ray.dir,  vec4(0, -1, 0, 2),  result.xy, prd.normal))) {\n        material.type = LAMBERT;\n        material.color = vec3(1.0);\n    } // top\n    \n    if (compare(result, intersect_3(ray.o, ray.dir,  vec4(0, 0, 1, 1), result.xy, prd.normal))) {    \n        material.type = LAMBERT;\n        material.color = vec3(1.0);\n    } // back  \n\n    prd.light = false;\n    int lightId;     \n\n    // if we detect lights first, we must ensure that prd.light is set false    \n    if ((visible == 1.0 || prd.bounce > 0) && (trace_lights(result, ray, lightId))) {\n        Light light = lights[lightId];        \n        prd.light = true;\n        prd.li = light.color;\n    } \n\n    return result.y;\n\n}\n\nuniform sampler2D wood;\n\nvec2 map_dir_to_uv(vec3 dir) {\n    float PI = 3.14;\n    float phi = atan(dir.z, dir.x);  // [-PI , PI]\n    float theta = asin(dir.y); // [-PI/2, PI/2]\n    vec2 uv;\n    uv.x = phi / (2.0 * PI) + 0.5; // [0, 1], +x -> 0.5\n    uv.y = theta / PI + 0.5; // [0, 1]\n    return uv;\n}\n\n// sample_f\nvec3 material_sample (inout Material mat, vec2 u, in vec3 hit, in vec3 N, in vec3 wo, inout vec3 wi, inout float pdf) {\n    vec3 bsdf;\n    switch(mat.type) {\n        case LAMBERT:\n            bsdf = sample_f_1921068617(u, N, wo, wi, pdf) * mat.color;\n            break;\n        case METAL_SPECULAR:\n            bsdf = metal_sample_f(u, N, wo, wi, pdf) * mat.color;\n            break;\n        case GLASS_SPECULAR:    \n            bsdf = glass_sample_f(u, N, wo, wi, pdf);\n            break;\n        case WOOD:\n            vec3 dir = normalize(hit - vec3(SPHERE_POSITION));\n            vec2 uv = map_dir_to_uv(dir);\n            vec4 woodTex = texture(wood, uv);\n            bsdf = sample_f_1921068617(u, N, wo, wi, pdf) * woodTex.rgb;\n    }\n    return bsdf;\n}\n\nvec3 material_eval (inout Material mat, in vec3 hit, in vec3 N, in vec3 wo, in vec3 wi) {\n    vec3 bsdf;\n    switch(mat.type) {\n        case LAMBERT:\n            bsdf = eval_0(N, wo, wi) * mat.color;\n            break;\n        case METAL_SPECULAR:\n        case GLASS_SPECULAR:\n            bsdf = vec3(0);\n            break; // no chance\n        case WOOD:\n            vec3 dir = normalize(hit - vec3(SPHERE_POSITION));            \n            vec2 uv = map_dir_to_uv(dir);\n            vec4 woodTex = texture(wood, uv);\n            bsdf = eval_0(N, wo, wi) * woodTex.rgb;            \n    }\n    return bsdf;\n}\n\nfloat material_pdf(int type, vec3 normal, vec3 wi, vec3 wo) {\n    float pdf;\n    switch(type) {\n        case LAMBERT:\n            pdf = pdf_0(normal, wi);\n        case METAL_SPECULAR:            \n            pdf = 0.0; // no chance\n    }\n    return pdf;\n}\n\nvoid direct_sample_light(inout uint seed, inout PerRayData prd, in Material material) {\n    vec3 li; vec3 sample_dir; float pdf; float dist; vec3 wi; vec3 facing_dir; vec3 cross_uv;\n    for (int i = 0; i < LIGHT_NUM; i++) {\n        Light light = lights[i];\n\n        switch (light.type) {\n            case QUAD_LIGHT:\n                cross_uv = cross(light.u, light.v);\n                float area = length(cross_uv) * 4.;\n                vec2 rand = 2.0 * hash2(seed) - 1.0;    \n                wi = light.pos + rand.x * light.u + rand.y * light.v - prd.hit;\n                dist = length(wi);\n                wi = wi / dist;\n                li = light.color;\n                pdf = (dist * dist / abs(dot(normalize(cross_uv), wi))) * (1. / area); // convert pdf(A) to pdf(W)\n                break;\n            case DIR_LIGHT:\n                break;\n        }\n\n        if (dot(prd.normal, wi) <= 0. || pdf <= 0.0) break; // shading nomral is not facing the sample light\n        Ray ray;\n        ray.o = prd.hit;\n        ray.dir = wi;\n        if (trace_shadow(vec2(EPS, dist), ray) < dist) break;  // damn we are in shadow\n        vec3 bsdf = material_eval(material, prd.hit, prd.normal, prd.wo, wi);\n        prd.rad += prd.throughput * bsdf * li / max(0.0001, pdf);\n    }\n\n}\n\nvec3 run_path_tracer(inout Ray ray, inout uint seed) {\n    PerRayData prd;\n    prd.rad = vec3(0);\n    prd.throughput = vec3(1.0);\n    prd.light = false;\n    Material material;\n    bool is_specular_bounce = false;\n    for (int bounce = 0; bounce <= MAX_BOUNCES; bounce++) {\n        prd.bounce = bounce;\n        float t = trace_ray(vec2(EPS, MAX_DIST), ray, prd, material);    \n        if (prd.light) {        \n            #ifndef DIRECT_LIGHT_SAMPLE\n                prd.rad += prd.throughput * prd.li;\n            #else\n                if (bounce == 0 || is_specular_bounce) prd.rad += prd.throughput * prd.li;\n            #endif\n            break; // quit here\n        }\n\n        vec3 hit = ray.o + ray.dir * t;\n        prd.hit = hit;\n        prd.wo = -ray.dir;\n\n        is_specular_bounce = (material.type == METAL_SPECULAR || material.type == GLASS_SPECULAR);\n\n        #ifdef DIRECT_LIGHT_SAMPLE\n            if (!is_specular_bounce) direct_sample_light(seed, prd, material);\n        #endif\n        float pdf;        \n\n        vec3 bsdf = material_sample(material, hash2(seed), hit, prd.normal, prd.wo, prd.wi, pdf);\n        \n        prd.throughput *= bsdf / vec3(pdf);\n        ray.o = hit;\n        ray.dir = prd.wi;        \n    }\n    return prd.rad;\n}\n\nuniform float intensity;\nuniform int num;\n\nvoid createQuadLight(vec3 u, vec3 v, vec3 pos, vec3 color, inout Light light) {\n    mat3 invRot = transpose(mat3(normalize(u), normalize(cross(v, u)), normalize(v)));        \n    light = Light(QUAD_LIGHT, vec3(color), pos, u, v, invRot);        \n}\n\nvoid init_lights() {\n    \n    vec3 u = vec3(.4, 0, 0);\n    vec3 v = vec3(0, 0, .4);\n    vec3 pos = vec3(0, 2.0, 0.0);            \n\n    if (num >= 0)  {        \n        createQuadLight(u, v, pos, vec3(intensity), lights[0]);\n    }    \n    \n    if (num >= 1) {\n        u = vec3(0.15, 0, 0);\n        v = vec3(0, -0.15, 0.15);\n        pos = vec3(0.8, 1, 1);\n        createQuadLight(u, v, pos, vec3(intensity), lights[1]);\n    }\n\n    if (num >= 2) {\n        u = vec3(0.15, 0, 0);\n        v = vec3(0, -0.15, 0.15);     \n        pos = vec3(-0.4, 1.3, 1);\n        createQuadLight(u, v, pos, vec3(intensity), lights[2]);        \n    }\n\n}\n\nuniform vec2 mouseXY;\n\nvoid main() {\n     \n    vec3 eye = vec3(0., 1., 2.9);\n    vec2 moveSpeed = vec2(.5);\n    if (mouseXY != vec2(0.0)) {\n        eye.xy += moveSpeed * 2.0 * mouseXY / size; // -1, 1\n    }\n    vec3 tar = vec3(0., 1., 2.0);\n    vec2 ndc = (gl_FragCoord.xy - 0.5) / size * 2.0 - 1.0;  // -1, 1\n    //float seed = float(baseHash(floatBitsToUint(ndc))) / float(0xffffffffU) + time;  // hash1\n    uint seed = uint(uint(gl_FragCoord.x) * uint(1973) + uint(gl_FragCoord.y) * uint(9277) + uint(frame) * uint(26699)) | uint(1);    \n\n    ndc += 2.0 * hash2(seed) / size; // jitter AA    \n    Ray ray = camera_ray_3771232466(eye, tar, ndc);    \n\n    init_lights();\n    vec3 rad = run_path_tracer(ray, seed);    \n    // windows wired black dots\n    vec4 result = max(min(vec4(rad, 1.0), vec4(1000.0)), vec4(vec3(EPS), 1.0));\n\n    if (frame > 0) {\n        vec2 uv = gl_FragCoord.xy / size;    \n        vec4 prev = texture(buffer, uv);\n        result = mix(result, prev, float(frame) / (float(frame) + 1.));\n    }\n\n    fragColor = result;\n\n}\n'])});const g=await s({wood:t+"/assets/wood.jpg"}),S=o({vs:u,fs:_(["#version 300 es\nprecision highp float;\n#define GLSLIFY 1\nuniform vec2 size;\nuniform sampler2D buffer;\n\nout vec4 fragColor;\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / size;\n    vec4 color = texture(buffer, uv);\n    fragColor = vec4(sqrt(color.rgb), color.a);\n}\n"])}),I=new n(!0),M=new r(l,{webgl2:!0});let N,x=0;const b={dataType:a.FLOAT,format:a.RGBA,internalFormat:a.RGBA32F,wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,magFilter:a.NEAREST,minFilter:a.NEAREST,anistropy:1};let F=new i(b),L=new i(b),y=0,C=0,O=0,B=0,w="idle";l.onmousedown=t=>{w="down",y=t.x,C=t.y,e=0},l.onmouseup=e=>{w="idle"},l.onmousemove=t=>{"idle"!=w&&(O+=t.x-y,B+=t.y-C,y=t.x,C=t.y,e=0)};const D=new h;D.showPanel(0),document.body.appendChild(D.dom);const P=()=>{const t=I.getIntervalSeconds();N=requestAnimationFrame(P),M.computeCanvasSize()&&(M.context.setScreenViewport([0,0,M.width,M.height]),F.resize(M.width,M.height),L.resize(M.width,M.height),e=0);try{x+=t,D.begin(),((e,t,r)=>{e.context.bindRenderTarget(F);const n={size:[e.width,e.height],frame:t,time:r,buffer:L.colorTexture,wood:g.wood,color:f,type:c,MAX_BOUNCES:Number(d),mouseXY:[O,-B],intensity:E,num:T,visible:1};e.draw(v,{uniforms:n}),e.context.bindRenderTarget(null),n.buffer=F.colorTexture,e.draw(S,{uniforms:n});let i=F;F=L,L=i})(M,e++,x),D.end()}catch(e){console.error(e),cancelAnimationFrame(N)}};P()}()}).call(this)}).call(this,"/pathtracer_3")},{"../BigTriangle":2,"../RenderTarget":12,"../StopWatch":14,"../WebGLCanvas":18,"../WebGLConstants":20,"../loader/texture":24,glslify:34,"stats-js":44}]},{},[47]);
